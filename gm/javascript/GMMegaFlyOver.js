/* GMMegaFlyOver.js <?php
#   --------------------------------------------------------------
#   GMMegaFlyOver.js 2012-01-31 gambio
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2012 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6 1u(e){l f=4,y=0,m=0,10=e,O=1v 1w(),n=\'\',z=0,11=A,t=0;4.12=6(){$(\'#3\').P();$(\'.13\').14(\'<B Q="3"></B>\');$(\'#3\').8({15:"A",16:"17",18:"1x"});$(\'#3\').1y(\'19.1a?1b=1c&1d=0&1e=\'+1f);$(\'.7\').u(6(a){2(9)g.h(\'7 u (1z 1A)\');$(\'#3\').8({C:a.o+5,D:a.p+5,18:"1B"})});$(\'.7\').R(6(a){$(\'#3\').8({C:a.o+5,D:a.p+5})})};4.1g=6(){$(\'.7\').1h(\'R\');$(\'.7\').1i(\'R\',6(a){O=a;f.S(a)});$(\'.7\').1h(\'u\');$(\'.7\').1i(\'u\',6(b){2(9)g.h(\'7 u\');l c=4;2(E($(4).F(\'G\').v(\'1j\'))!=\'H\'){$(4).F(\'G\').v(\'1j\',\'\')}2(E($(4).F(\'G\').v(\'1k\'))!=\'H\'){$(4).F(\'G\').v(\'1k\',\'\')}$(\'#3\').P();$(\'.13\').14(\'<B Q="3" 1C="1D-1E"></B>\');$(\'#3\').8({15:"A",16:"17",C:b.o+5,D:b.p+5});$(\'#3\').T();l d=$(4).v(\'Q\');d=d.1F(\'1G\');d=d.1H();2(9)g.h(\'1I: \'+d);n=d;$(4).1l(\'j\');$(4).j(6(a){2(9)g.h(\'7 j: \'+d);n=\'\';I(z);J(m)});I(z);z=1m(6(){f.1n(n)},A)})};4.1n=6(c){2(c!=\'\'&&c==n){1J.1o({1K:\'\',1L:\'19.1a?1b=1c&1d=\'+q(c)+\'&1e=\'+1f,1M:"1N",1O:K,1p:6(b){2(c==n){$(\'#3\').1q(b);2(10==K){J(m);m=1P(f.1r,1Q)}w{$(\'#r .k\').U(0).x()}$(\'#3\').x();f.S(O);$(\'.7\').1l(\'j\');$(\'.7\').j(6(a){2(9)g.h(\'7 j: \'+c);2(E 1s==\'H\'){I(y);J(m);$(\'#3\').T();$(\'#3\').P()}})}w{2(9)g.h(\'j 1R 1o-1S 1p\')}}}).1q}};4.1r=6(){l a=K;t++;1T(i=0;i<s.V.L;++i){2(s.V[i].1U!=K){a=1V}}2(a||t>11||1W.1X.1Y(/1Z/)!=-1){J(m);t=0;f.W(0)}w{2(9)g.h(\'21 V... 22: \'+t)}23 a};4.S=6(a){2($(\'#3\').L>0){l b=a.o+5,X=a.p+5;2($(s).Y()<(a.o-$(s).1t()+q($(\'#3\').8(\'Y\').M(\'N\',\'\'))+20)){b=(a.o-$(s).1t()-(q($(\'#3\').8(\'Y\').M(\'N\',\'\'))+20))}2((q($(\'#3\').8(\'Z\').M(\'N\',\'\'))+20)+a.p>$(24).Z()+$(s).25()){X=a.p-(q($(\'#3\').8(\'Z\').M(\'N\',\'\'))+20)}$(\'#3\').8({C:b,D:X})}};4.W=6(a){2($(\'#r .k\').L>1){l b=q(a);2(b>=$(\'#r .k\').L){b=0}$(\'#r .k\').T();2(9)g.h(\'x k \'+b);$(\'#r .k\').U(b).x();b++;I(y);y=1m(6(){f.W(b)},26)}w{$(\'#r .k\').U(0).x()}};2(E(1s)==\'H\'){4.1g()}w{4.12()}}',62,131,'||if|flyover_layer|this||function|flyover_item|css|fb|||||||console|log||mouseout|flyover_image|var|t_interval|t_mouse_over_element_id|pageX|pageY|Number|flyover|document|t_image_check_loops|mouseover|attr|else|show|t_timeout|t_request_timeout|100|div|left|top|typeof|find|img|undefined|clearTimeout|clearInterval|true|length|replace|px|coo_event|remove|id|mousemove|position_flyover|hide|eq|images|start_slideshow|t_page_y|width|height|t_slideshow|t_max_image_check_loops|bind_styleedit_mode|wrap_shop|append|zIndex|position|absolute|display|request_port|php|module|MegaFlyover|mf_products_id|XTCsid|gm_session_id|bind_flyover|die|live|alt|title|unbind|setTimeout|start_request|ajax|success|html|image_check|gm_style_edit_mode_running|scrollLeft|GMMegaFlyOver|new|Object|none|load|SE|mode|block|class|png|fix|split|_|pop|products_id|jQuery|data|url|type|POST|async|setInterval|50|before|request|for|complete|false|navigator|userAgent|search|Opera||loading|loop|return|window|scrollTop|1000'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function GMMegaFlyOver(p_slideshow)
{
	var coo_this = this;
	var t_timeout = 0;
	var t_interval = 0;
	var t_slideshow = p_slideshow;
	var coo_event = new Object();
	var t_mouse_over_element_id = '';
	var t_request_timeout = 0;
	var t_max_image_check_loops = 100;
	var t_image_check_loops = 0;

	this.bind_styleedit_mode = function()
	{
		$('#flyover_layer').remove();
		$('.wrap_shop').append('<div id="flyover_layer"></div>');

		$('#flyover_layer').css({
			zIndex: 		"100",
			position: 	"absolute",
			display:	"none"
		});
		$('#flyover_layer').load('request_port.php?module=MegaFlyover&mf_products_id=0&XTCsid='+gm_session_id);


		$('.flyover_item').mouseover(function(event)
		{
			if(fb)console.log('flyover_item mouseover (SE mode)');

			$('#flyover_layer').css({
				left: 			event.pageX + 5,
				top: 				event.pageY + 5,
				display:	"block"
			});
		});

		$('.flyover_item').mousemove(function(event)
		{
			$('#flyover_layer').css({
				left: 			event.pageX + 5,
				top: 				event.pageY + 5
			});
		});
	}

	this.bind_flyover = function()
	{
		$('.flyover_item').die('mousemove');
		$('.flyover_item').live('mousemove', function(event)
		{
			coo_event = event;
			coo_this.position_flyover(event);
		});

		$('.flyover_item').die('mouseover');
		$('.flyover_item').live('mouseover', function(event)
		{
			if(fb)console.log('flyover_item mouseover');

			var t_this_element = this;

			if(typeof($(this).find('img').attr('alt')) != 'undefined')
			{
				$(this).find('img').attr('alt', '');
			}
			if(typeof($(this).find('img').attr('title')) != 'undefined')
			{
				$(this).find('img').attr('title', '');
			}

			$('#flyover_layer').remove();
			$('.wrap_shop').append('<div id="flyover_layer" class="png-fix"></div>');

			$('#flyover_layer').css({
				zIndex: 		"100",
				position: 	"absolute",
				left: 			event.pageX + 5,
				top: 				event.pageY + 5
			});

			$('#flyover_layer').hide();

			var products_id = $(this).attr('id');
			products_id = products_id.split('_');
			products_id = products_id.pop();
			if(fb)console.log('products_id: ' + products_id);

			t_mouse_over_element_id = products_id;
			$(this).unbind('mouseout');
			$(this).mouseout(function(event)
			{
				if(fb)console.log('flyover_item mouseout: ' + products_id);
				t_mouse_over_element_id = '';
				clearTimeout(t_request_timeout);
				clearInterval(t_interval);
			});

			clearTimeout(t_request_timeout);
			t_request_timeout = setTimeout(function(){coo_this.start_request(t_mouse_over_element_id);}, 100);
		});
	}

	this.start_request = function(p_mouse_over_element_id)
	{
		if(p_mouse_over_element_id != '' && p_mouse_over_element_id == t_mouse_over_element_id)
		{
			jQuery.ajax({data:		'',
						url: 		'request_port.php?module=MegaFlyover&mf_products_id=' + Number(p_mouse_over_element_id) + '&XTCsid=' + gm_session_id,
						type: 		"POST",
						async:		true,
						success:	function(t_flyover_html)
							{
								if(p_mouse_over_element_id == t_mouse_over_element_id)
								{
									$('#flyover_layer').html(t_flyover_html);

									if(t_slideshow == true)
									{
										clearInterval(t_interval);
										t_interval = setInterval(coo_this.image_check, 50);
									}
									else
									{
										$('#flyover .flyover_image').eq(0).show();
									}

									$('#flyover_layer').show();
									coo_this.position_flyover(coo_event);

									$('.flyover_item').unbind('mouseout');
									$('.flyover_item').mouseout(function(event)
									{
										if(fb)console.log('flyover_item mouseout: ' + p_mouse_over_element_id);

										if(typeof gm_style_edit_mode_running == 'undefined')
										{
											clearTimeout(t_timeout);
											clearInterval(t_interval);
											// IE6-workaround: hide before removing to avoid shadow deposit on screen
											$('#flyover_layer').hide();
											$('#flyover_layer').remove();
										}
									});
								}
								else
								{
									if(fb)console.log('mouseout before ajax-request success');
								}
							}
						}).html;
		}
	}

	this.image_check = function()
	{
		var t_image_loaded = true;
		t_image_check_loops++;

		for(i = 0; i < document.images.length; ++i)
		{
			if(document.images[i].complete != true)
			{
				t_image_loaded = false;
			}
		}


		if(t_image_loaded || t_image_check_loops > t_max_image_check_loops
			|| navigator.userAgent.search(/Opera/) != -1) // Opera has problems to check image complete status -> ignore check
		{
			clearInterval(t_interval);
			t_image_check_loops = 0;
			coo_this.start_slideshow(0);
		}
		else
		{
			if(fb)console.log('loading images... loop: ' + t_image_check_loops);

		}

		return t_image_loaded;
	}

	this.position_flyover = function(event)
	{
		if($('#flyover_layer').length > 0)
		{
			var t_page_x = event.pageX + 5;
			var t_page_y = event.pageY + 5;

			if($(document).width() < (event.pageX - $(document).scrollLeft() + Number($('#flyover_layer').css('width').replace('px', '')) + 20))
			{
				t_page_x = (event.pageX - $(document).scrollLeft() - (Number($('#flyover_layer').css('width').replace('px', '')) + 20));
			}

			if((Number($('#flyover_layer').css('height').replace('px', '')) + 20) + event.pageY >  $(window).height() + $(document).scrollTop())
			{
				t_page_y = event.pageY - (Number($('#flyover_layer').css('height').replace('px', '')) + 20);
			}

			$('#flyover_layer').css(
			{
				left: t_page_x,
				top: t_page_y
			});
		}
	}

	this.start_slideshow = function(p_image_number)
	{
		if($('#flyover .flyover_image').length > 1)
		{
			var t_image_number = Number(p_image_number);

			if(t_image_number >= $('#flyover .flyover_image').length)
			{
				t_image_number = 0;
			}

			$('#flyover .flyover_image').hide();

			if(fb)console.log('show flyover_image ' + t_image_number);
			$('#flyover .flyover_image').eq(t_image_number).show();

			t_image_number++;

			clearTimeout(t_timeout);
			t_timeout = setTimeout(function(){coo_this.start_slideshow(t_image_number);}, 1000);
		}
		else
		{
			$('#flyover .flyover_image').eq(0).show();
		}
	}

	if(typeof(gm_style_edit_mode_running) == 'undefined')
	{
		this.bind_flyover();
	}
	else
	{
		this.bind_styleedit_mode();
	}
}
/*<?php
}
?>*/
