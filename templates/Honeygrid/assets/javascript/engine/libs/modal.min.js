"use strict";jse.libs.template.modal=jse.libs.template.modal||{},function(e){var t=($("body"),[]),a=null,n={yes:{name:jse.core.lang.translate("yes","buttons"),type:"success","class":"btn-success"},no:{name:jse.core.lang.translate("no","buttons"),type:"fail","class":"btn-default"},abort:{name:jse.core.lang.translate("abort","buttons"),type:"fail","class":"btn-default"},ok:{name:jse.core.lang.translate("ok","buttons"),type:"success","class":"btn-success"},close:{name:jse.core.lang.translate("close","buttons"),type:"fail","class":"btn-default"}},l=function(e,t){var a=e.filter("form").add(e.find("form")),n={},l=[];return a.length&&a.each(function(){var e=$(this);if(t){var a=$.Deferred();l.push(a),e.trigger("validator.validate",{deferred:a})}n[e.attr("name")||e.attr("id")||"form_"+(new Date).getTime()*Math.random()]=jse.libs.form.getData(e)}),$.when.apply(void 0,l).then(function(){return n},function(){return n}).promise()},r=function(e,t){if(e.buttons){var n=a.getRejectHandler,r=a.getResolveHandler;$.each(e.buttons,function(a,o){e.buttons[a].event=function(){var e=$(this);if("function"==typeof o.callback&&!o.callback.apply(e,[]))return!1;switch(o.type){case"fail":n(e,t,l);break;case"success":r(e,t,l);break;case"link":location.href=o.value}}})}},o=function(e,t){var a=e.find("form");a.length&&a.on("submit",function(e){e.preventDefault()}),window.gambio&&window.gambio.widgets&&window.gambio.widgets.init&&window.gambio.widgets.init(e)},s=function(e){jse.libs.template.modal[e]?a=jse.libs.template.modal[e]:jse.core.debug.error("[MODAL] Can't set modal: \""+e+"\". Extension doesn't exist")},i=function(e){var t=a.getMapper(),n={};return $.each(e,function(e,a){if(t[e]===!1)return!0;if(void 0===t[e])n[e]=a;else if("function"==typeof t[e]){var l=t[e](e,a);n[l[0]]=l[1]}else n[t[e]]=a}),n},c=function(e,a){var n=[],l=$.Deferred();if(e.noTemplate)l.resolve("");else if(a)l.resolve('<iframe width="100%" height="100%" frameborder="0" src="'+e.template+'" />');else if(e.storeTemplate&&t[e.template])l.resolve(t[e.template]);else{try{n=$(e.template)}catch(r){}n.length?l.resolve(n.html()):jse.libs.xhr.ajax({url:e.template,dataType:"html"}).done(function(a){e.sectionSelector&&(a=$(a).find(e.sectionSelector).html()),e.storeTemplate&&(t[e.template]=a),l.resolve(a)}).fail(function(){l.reject()})}return l},f=function(e,t,n,o,s){var f=$.Deferred(),u=f.promise(),d="iframe"===s,m={title:t,dialogClass:n,modal:!0,buttons:o||[],closeOnEscape:!0,template:s||null,storeTemplate:!1,closeX:!0,closeOnOuter:!0},p=$.Deferred();e=e||{},e=$.extend({},m,e);var b=c(e,d).done(function(t){p.done(function(e){f.resolve(e)}).fail(function(e){f.reject(e)}),e.template=$(Mustache.render(t,e)),jse.libs.template.helpers.setupWidgetAttr(e.template),e.template=$("<div>").append(e.template.clone()).html(),r(e,p);var n=$.extend({},e);e=i(e),a.openLayer(e,p,l,n),u.close=function(e){p.close(e)}}).fail(function(){f.reject({error:"Template not found"})});return u.close||(u.close=function(){b.reject("Closed after opening")}),u},u=function(e){return f(e,jse.core.lang.translate("hint","labels"),"",[n.close],"#modal_alert")},d=function(e){return f(e,jse.core.lang.translate("confirm","labels"),"confirm_dialog",[n.yes,n.no],"#modal_alert")},m=function(e){return f(e,jse.core.lang.translate("prompt","labels"),"prompt_dialog",[n.ok,n.abort],"#modal_prompt")},p=function(e){return f(e,jse.core.lang.translate("success","labels"),"success_dialog",[],"#modal_alert")},b=function(e){return f(e,jse.core.lang.translate("errors","labels"),"error_dialog",[],"#modal_alert")},g=function(e){return f(e,jse.core.lang.translate("warning","labels"),"warn_dialog",[],"#modal_alert")},v=function(e){return f(e,jse.core.lang.translate("info","labels"),"info_dialog",[],"#modal_alert")},j=function(e){return e.convertModal?void jse.libs.template.modal[e.convertModal](e,jse.core.lang.translate("info","labels"),e.convertModal+"_dialog",[],"#modal_alert"):f(e,jse.core.lang.translate("info","labels"),"iframe_layer",[],"iframe")};e.error=b,e.warn=g,e.info=v,e.success=p,e.alert=u,e.prompt=m,e.confirm=d,e.iframe=j,e.custom=f,e.setLayer=s,e.finalizeLayer=o;var h=Date.now,w=1e4;a=jse.core.registry.get("mainModalLayer");var y=setInterval(function(){if(void 0!==jse.libs.template.modal[a]&&(s(a),clearInterval(y)),Date.now-h>w)throw new Error("Modal extension was not loaded: "+a)},300)}(jse.libs.template.modal);