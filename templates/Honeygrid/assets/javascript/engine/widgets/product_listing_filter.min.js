"use strict";gambio.widgets.module("product_listing_filter",["url_arguments",gambio.source+"/libs/events"],function(e){var t=$(this),a=$("body"),i=null,s=null,r=null,n=null,l=null,o=!1,u={},d={target:null},c=$.extend(!0,{},d,e),f={},m=function(e){var t="";n.find("a").each(function(){var a=$(this),i=a.parseModuleData("product_listing_filter");e.add!==i.add?(t+=i.add+" ",a.removeClass("active")):a.addClass("active")}),u.open=!1,i.off(jse.libs.template.events.TRANSITION_FINISHED()).one(jse.libs.template.events.TRANSITION_FINISHED(),function(){u.open=!0,i.removeClass(t).addClass(e.add).trigger(jse.libs.template.events.TRANSITION(),u)}).trigger(jse.libs.template.events.TRANSITION(),u)},g=function(e){l.find("a").each(function(){var t=$(this).attr("href");$(this).attr("href",jse.libs.url_arguments.replaceParameterValue(t,"view_mode",e))})},v=function(e){e&&e.preventDefault();var a=$(this),i=a.parseModuleData("product_listing_filter"),s=i.urlParam;if(!a.hasClass("active")&&(t.trigger(jse.libs.template.events.OPEN_FLYOUT(),t),m(i),g(s),r.val(s),o&&e&&e.data&&e.data.history)){var n=jse.libs.url_arguments.replaceParameterValue(location.href,"view_mode",s);history.pushState({state:s},s,n),t.trigger("pushstate",{state:s})}},p=function(e,a){var i=a||(e.originalEvent?e.originalEvent:{state:""}),s=n.find('[data-product_listing_filter-url-param="'+i.state+'"]');if(s.length&&!a.noButton)v.call(s);else{var r=t.find(".jsPanelViewmode a.active"),l=r.parseModuleData("product_listing_filter");g(l.urlParam)}},h=function(){s.submit()};return f.init=function(e){if(i=$(c.target),s=t.find("form"),r=s.find('input[name="view_mode"]'),n=t.find(".jsPanelViewmode"),l=t.find(".pagination"),o=jse.core.config.get("history"),u.classClose="fadeOut",o){var d=jse.libs.url_arguments.getUrlParameters().view_mode,f=history.state||{},m=jse.libs.url_arguments.replaceParameterValue(location.href,"view_mode",d);f.state=d,history.replaceState(f,d,m)}t.on("change","select.jsReload",h).on("click",".jsPanelViewmode a",{history:!0},v),a.on("pushstate pushstate_no_history",p),$(window).on("popstate",p),e()},f});