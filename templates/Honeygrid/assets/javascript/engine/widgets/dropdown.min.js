"use strict";gambio.widgets.module("dropdown",[gambio.source+"/libs/events",gambio.source+"/libs/responsive"],function(e){var n=$(this),t=$("body"),r={},i={breakpoint:40,container:".custom-dropdown",openClass:"open",hideActive:!0,shorten:10,shortenOnInit:!1,shortenOnMobile:!1,triggerChange:!0,triggerNoChange:!1},o=$.extend(!0,{},i,e),s={},a=function(e,n){if(n.hideActive){var t=e.children("select"),r=t.children(":selected").val();e.find("li").show().children('a[rel="'+r+'"]').parent().hide()}},l=function(e){var n=e.children(),t=e.children("select"),r=t.children(":disabled");n.find(".disabled").removeClass("disabled"),r.each(function(){var e=$(this),t=e.val();n.find('a[rel="'+t+'"]').parent().addClass("disabled")})},d=function(e,n){var t=e.children().not(".dropdown-name"),r=e.children(".dropdown-name"),i=e.width(),o=n.length,s="",a=!1,l=0,d=null;for(t.each(function(){i-=$(this).outerWidth()}),l;l<o;l+=1){if(d=n.substring(0,l)+"...",r.text(d),r.width()>i){a=!0;break}s=d}return a?s:n},c=function(e,n){var t=e.length,r=t-n.shorten;return r>0?(r+=3,e.substring(0,t-r)+"..."):e},h=function(e,n,t){return(o.breakpoint<jse.libs.template.responsive.breakpoint().id||t.shortenOnMobile)&&("fit"===t.shorten?n=d(e,n):t.shorten&&(n=c(n,t))),n},p=function(){var e=$(this),n=e.closest(o.container),t=n.children("select"),i=$.extend({},o,n.parseModuleData("dropdown"));r.open=!1,n.trigger(jse.libs.template.events.TRANSITION(),r),i.triggerNoChange&&t.trigger("change",[])},g=function(e){e.preventDefault(),e.stopPropagation();var t=$(this),i=t.closest(o.container),s=i.children("select"),d=$.extend({},o,i.parseModuleData("dropdown"));i.hasClass(o.openClass)?(r.open=!1,i.trigger(jse.libs.template.events.TRANSITION(),r),d.triggerNoChange&&s.trigger("change",[])):(a(i,d),l(i),r.open=!0,i.trigger(jse.libs.template.events.TRANSITION(),r),n.trigger(jse.libs.template.events.OPEN_FLYOUT(),[i]))},u=function(e){e.preventDefault(),e.stopPropagation();var n=$(this),t=n.parent();if(!t.hasClass("disabled")){var i=n.closest(o.container),s=i.children("button"),a=i.children("select"),l=a.children(":selected").val(),d=n.attr("rel"),c=n.text(),p=$.extend({},o,i.parseModuleData("dropdown"));if(l!==d){var g=h(s,c,p);s.children(".dropdown-name").text(g),a.children('[value="'+d+'"]').prop("selected",!0),p.triggerChange&&a.trigger("change",[])}else p.triggerNoChange&&a.trigger("change",[]);r.open=!1,i.trigger(jse.libs.template.events.TRANSITION(),r)}},v=function(){var e=n.find(o.container);o.breakpoint<jse.libs.template.responsive.breakpoint().id||o.shortenOnMobile?e.each(function(){var e=$(this),n=e.children("button"),t=n.children(".dropdown-name"),r=e.find("select option:selected").text(),i=$.extend({},o,e.parseModuleData("dropdown")),s=h(n,r,i);t.text(s)}):e.removeClass(o.openClass).each(function(){var e=$(this),n=e.find(".dropdown-name"),t=e.find("select option:selected").text();n.text(t)})},b=function(e,t){var r=n.find(o.container),i=t||$(e.target).closest(o.openClass);r=r.not(i),r.removeClass(o.openClass)};return s.init=function(e){r.classOpen=o.openClass,t.on(jse.libs.template.events.OPEN_FLYOUT()+" click",b).on(jse.libs.template.events.BREAKPOINT(),v),n.on("click",o.container+" button",g).on("click",o.container+" ul a",u).on("change",o.container+" select",p),o.shortenOnInit&&v(),e()},s});