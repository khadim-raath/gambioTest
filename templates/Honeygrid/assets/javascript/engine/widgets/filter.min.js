"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};gambio.widgets.module("filter",["form","xhr"],function(e){var t=$(this),i=$("body"),o=null,n=null,r=null,a=null,l=null,s=null,p=!1,c=!1,d=!1,f={requestUrl:"shop.php?do=Filter",resetProductlistingFilter:!1,autoUpdate:!0,updateDelay:200,retries:2,retryDelay:500,selectorMapping:{filterForm:".filter-box-form-wrapper",productsContainer:".product-filter-target",filterSelectionContainer:".filter-selection-container",listingPagination:".productlisting-filter-container .panel-pagination",filterHiddenContainer:".productlisting-filter-container .productlisting-filter-hiddens",paginationInfo:".pagination-info"}},u=$.extend(!0,{},f,e),g={},h=function(e){var i="";s&&s.abort(),c&&(i="&reset=true"),s=$.ajax({url:u.requestUrl+"/GetListing&"+t.serialize()+i,method:"GET",dataType:"json"}).done(function(i){if("undefined"!=typeof i.redirect)return void(location.href=i.redirect);!d&&u.autoUpdate&&($(window).on("popstate",w),d=!0),jse.libs.template.helpers.fill(i.content,n,u.selectorMapping);var o=$(u.selectorMapping.productsContainer);if(o.attr("data-gambio-widget","cart_handler"),gambio.widgets.init(o),p&&e){var r=decodeURIComponent(t.serialize());history.pushState({},"filter",location.origin+location.pathname+"?"+r+location.hash),t.trigger("pushstate",[])}else t.trigger("pushstate_no_history",[])})},m=function(e,t){var i=[];return $.each(e.filter_fv_id,function(e,o){if(void 0!==o&&o!==!1)if("object"===("undefined"==typeof o?"undefined":_typeof(o))){var n=[];$.each(o,function(e,t){t!==!1&&n.push(t)}),t?i.push(e+":"+n.join("|")):(i[e]=i[e]||[],i[e]=n)}else i.push(e+":"+o)}),e.filter_fv_id=t?i.join("&"):i,e},b=function T(e,n,a){o.removeClass("error").show(),l&&l.abort(),l=jse.libs.xhr.ajax({url:u.requestUrl,data:n},!0).done(function(e){var n=$(e.content.filter.selector).find("input:checkbox").length,r=$(e.content.filter.selector);if(n){var l=$("<div/>").appendTo("body").hide();t.children().appendTo(l).clone().appendTo(t),jse.libs.template.helpers.fill(e.content,l,u.selectorMapping),gambio.widgets.init(l);var s=setInterval(function(){l.find(".single-checkbox").length>0&&(t.children().remove(),l.children().appendTo(t),l.remove(),o.hide(),u.autoUpdate&&h(a),clearInterval(s))},300)}else jse.libs.template.helpers.fill(e.content,i,u.selectorMapping),gambio.widgets.init(r),o.hide(),u.autoUpdate&&h(a);window.gambio.widgets.init(t)}).fail(function(){e<u.retries?r=setTimeout(function(){T(e+1,n,a)},u.retryDelay):o.addClass("error")})},y=function(e){var i=jse.libs.form.getData(t);e=void 0===e||!!e,b(0,m(i,!0),e)},v=function(e){c=!1,u.autoUpdate?(e.preventDefault(),e.stopPropagation()):u.resetProductlistingFilter||jse.libs.form.addHiddenByUrl(t)},j=function(e){e.preventDefault(),e.stopPropagation(),clearTimeout(a),clearTimeout(r),a=setTimeout(y,u.updateDelay)},U=function(e){e.preventDefault(),e.stopPropagation(),jse.libs.form.reset(t),jse.libs.form.addHiddenByUrl(t),c=!0,u.autoUpdate?y():location.href=location.pathname+"?"+t.serialize()},w=function(){jse.libs.form.reset(t),jse.libs.form.prefillForm(t,jse.libs.template.helpers.getUrlParams()),y(!1)},x=function(){$(this).parent().removeClass("collapsed"),$(this).hide()},C=function(e){var t=$(this).attr("rel");e.preventDefault(),e.stopPropagation(),$("#"+t).prop("checked",!0).trigger("change")};return g.init=function(e){o=t.find(".preloader, .preloader-message"),n=$(".main-inside"),p=jse.core.config.get("history"),0===$(u.selectorMapping.productsContainer).length&&(u.autoUpdate=!1),t.on("change",'select, input[type="checkbox"], input[type="text"]',j).on("click",".btn-link",C).on("reset",U).on("submit",v).on("click",".show-more",x),i.addClass("filterbox-enabled"),e()},g});