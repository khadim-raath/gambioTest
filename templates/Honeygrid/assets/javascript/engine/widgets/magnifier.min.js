"use strict";gambio.widgets.module("magnifier",[gambio.source+"/libs/responsive"],function(e){var t=$(this),i=$("body"),a=null,n=!1,r={target:null,keepInView:!0,bodyClass:"magnifier-active",breakpoint:60},o=$.extend(!0,{},r,e),g={},s=function(e,t,i){var a={offset:e.offset(),height:e.height(),width:e.width(),targetWidth:t.width(),targetHeight:t.height(),imageWidth:i.width(),imageHeight:i.height()};return a.aspectX=-1/(a.width/a.imageWidth),a.aspectY=-1/(a.height/a.imageHeight),a.boundaryX=-1*(a.imageWidth-a.targetWidth),a.boundaryY=-1*(a.imageHeight-a.targetHeight),e.data("magnifier",a),n=!0,$.extend({},a)},h=function(e){var t=$(this),i=t.data("magnifier"),n=a.children("img");i=i||s(t,a,n);var r=i.aspectY*(e.pageY-i.offset.top)+i.targetHeight/2,g=i.aspectX*(e.pageX-i.offset.left)+i.targetWidth/2;o.keepInView&&(r=Math.min(0,r),r=Math.max(i.boundaryY,r),g=Math.min(0,g),g=Math.max(i.boundaryX,g)),n.css({"margin-top":r+"px","margin-left":g+"px"})},m=function(e){if(jse.libs.template.responsive.breakpoint().id>o.breakpoint){var t=$(this),n=t.data(),r=a.find(".preloader"),g=$("<img />"),s=t.attr("alt"),m=t.attr("title");a.children("img").remove(),r.show(),i.addClass(o.bodyClass),g.one("load",function(){g.css({height:this.height+"px",width:this.width+"px"}),r.hide(),t.off("mousemove.magnifier").on("mousemove.magnifier",h)}).attr({src:n.magnifierSrc,alt:s,title:m}),a.append(g).show()}},d=function(){n&&(t.find("img[data-magnifier-src]").removeData("magnifier"),n=!1)},f=function(){a.hide(),i.removeClass(o.bodyClass),t.off("mouseenter").on("mouseenter","img[data-magnifier-src]",m)},c=function(){t.off("mouseenter")};return g.init=function(e){a=$(o.target),t.on("touchstart","img[data-magnifier-src]",c).on("mouseenter","img[data-magnifier-src]",m).on("mouseleave","img[data-magnifier-src]",f),$(window).on("resize",d),e()},g});