"use strict";gambio.widgets.module("live_search",["form","xhr",gambio.source+"/libs/events",gambio.source+"/libs/responsive"],function(e){var t=$(this),n=$("body"),s=null,i=null,o=null,l=null,a=null,r={},u={needle:3,target:".search-result-container",delay:200,url:"shop.php?do=LiveSearch",breakpoint:40,reopen:!0,classOpen:"open"},p=$.extend(!0,{},u,e),c={},d=function(e){var t=s.find("li"),n=t.eq(e);t.removeClass("active"),e>=0&&n.addClass("active")},f=function(e){var t=s.find("li"),n=t.filter(".active"),i=null,o=null;switch(e.keyCode){case 13:n.length&&(e.preventDefault(),e.stopPropagation(),o=n.find("a").attr("href"),location.href=o);break;case 38:i=n.length?n.index()-1:t.length-1,d(i);break;case 40:i=n.length?n.index()+1:0,d(i)}},g=function(e){r.open=!0,s.html(e).trigger(jse.libs.template.events.TRANSITION(),r),t.trigger(jse.libs.template.events.OPEN_FLYOUT(),[t]),t.off("keydown.autosuggest").on("keydown.autosuggest",f)},b=function(){r.open=!1,s.off().one(jse.libs.template.events.TRANSITION_FINISHED(),function(){s.empty()}).trigger(jse.libs.template.events.TRANSITION(),r),t.off("keydown.autosuggest")},v=function(e){if($.inArray(e.keyCode,[13,37,38,39,40])>-1)return!0;var n=jse.libs.form.getData(t);return l&&clearTimeout(l),n.keywords.length<p.needle?void b():void(l=setTimeout(function(){o&&o.abort(),o=jse.libs.xhr.post({url:p.url,data:n,dataType:"html"},!0).done(function(e){e?g(e):b()})},p.delay))},m=function(){i.trigger("focus",[])},h=function(){var e=jse.libs.template.responsive.breakpoint().id<=p.breakpoint&&!a,t=jse.libs.template.responsive.breakpoint().id>p.breakpoint&&a;(e||t)&&s.removeClass(p.classOpen)},k=function(e,n){n===t||t.find($(e.target)).length||(s.removeClass(p.classOpen),i.trigger("blur",[]))};return c.init=function(e){var o=p.reopen?" focus":"";a=jse.libs.template.responsive.breakpoint().id<=p.breakpoint,r.classOpen=p.classOpen,s=t.find(p.target),i=t.find("input"),s.hide(),n.on(jse.libs.template.events.OPEN_FLYOUT()+" click",k).on(jse.libs.template.events.BREAKPOINT(),h),t.on("keyup"+o,"input",v).on("change","select",m),e()},c});