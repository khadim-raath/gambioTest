/* ButtonProductImagesHandler.js <?php
#   --------------------------------------------------------------
#   ButtonProductImagesHandler.js 2014-08-15 gambio
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2014 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('8 1W(h,i,j){4(r)s.t(\'1W 35\');u k=z;4(1i(h)==\'2g\'){k=h}u l=z;4(1i(i)==\'2g\'){l=i}u m=2I;4(2d(j)!=\'2C\'){m=2d(j)}u n=5,1w=0,15=1k 2K(),1m=z,1o=p,1M=0,19=\'\',1N=\'\';5.1c=8(){4(r)s.t(\'1W 1c\');5.1O();4(l){5.1Q()}4(k){5.1R()}L{$(\'.18\').H(\'y\');$(\'.18\').G(\'y\',8(){4(r)s.t(\'.18 y\');4($(\'.q .v .w #U\').F>0&&$(\'.q .v .w #U\').7(\'1d\')!=\'1a\'){n.1b(5)}Q p})}};5.1O=8(){4(r)s.t(\'1O\');u a=\'\';$(\'a.Z\').H(\'S\');$(\'a.Z\').G(\'S\',8(){4(r)s.t(\'a.Z S: \'+$(5).o(\'R\'));$(5).o(\'1g\',\'\');$(5).36(\'26\').o(\'1g\',\'\');4($(\'.q .v .w #U\').F==0||$(\'.q .v .w #U\').7(\'1d\')==\'1a\'){19=\'#\'+$(5).o(\'R\');4(1o==p){n.1b(5)}}Q p});$(\'.Z\').H(\'X\');$(\'.Z\').G(\'X\',8(){25(1w);4($(\'.q .v .w .I\').W()==\'1p...\'){$(\'.q .v .w .I\').W(1N);n.1c()}2u(1M);19=\'\';1o=z;1M=2v(n.1q,m);a=$(5).o(\'R\');a=a.x(\'1S\',\'\');$(\'.q .v .w #23\'+a).2X(\'a\').J(\'22\');Q p})};5.1q=8(){1o=p;4(19!=\'\'){4(r)s.t(\'1q(): \'+19);n.1b(19)}L{4(r)s.t(\'1q(): 3a 3b\')}};5.1b=8(a){4(1i($(a).o(\'R\'))!=\'21\'&&$(a).o(\'R\').12(\'1S\')!=-1){$(\'.q .v .w #U\').1Z();$(\'a.Z\').J(\'1z\');$(a).T(\'1z\');11=$(a).o(\'R\');11=11.x(\'1S\',\'\');15[11]=1k 24();15[11].1j=$(a).o(\'E\');27=5.1J(11,$(a).o(\'2f\'));4(27==p){1w=2w(8(){n.1J(11,$(a).o(\'2f\'))},2i)}}};5.1J=8(a,b){u c=P(a),1s=z;4(15[c].2Y!=z){1s=p}4(1s){25(1w);u d=\'\';4(k==p){d=\' 1E="37: 3c;"\'}u e=15[c].1j;e=e.2n(e.12(2q.2r.2s+\'2t\'),e.F);$(\'.q .v .w .I\').7(\'Y\',15[c].Y+\'D\');$(\'.q .v .w .I\').W(\'<a 2m="22" E="\'+b+\'"\'+d+\' 1g=""><26 R="23\'+c+\'" 1j="\'+e+\'" 2x="" 1g="" /></a>\');4(l){5.1Q()}}L{4($(\'.q .v .w .I\').W()!=\'1p...\'){1N=$(\'.q .v .w .I\').W()}$(\'.q .v .w .I\').W(\'1p...\');4(r)s.t(\'1p 2y...\')}Q 1s};5.1Q=8(){4($(\'.q .v .w #U\').F==0||$(\'.q .v .w #U\').7(\'1d\')==\'1a\'){$(\'.q .v .w .I\').W($(\'.q .v .w .I\').W());4($(".I").F>0){$(".I").2z()}}};5.1R=8(){4(r)s.t(\'1R\');$(\'.18\').H(\'y\');$(\'.18\').G(\'y\',8(){4(r)s.t(\'.18 y\');4($(\'.q .v .w #U\').F>0&&$(\'.q .v .w #U\').7(\'1d\')!=\'1a\'){n.1b(5)}L 4($(\'.q .v .w .I\').F>0){$(\'.2A\').2B(\'<1y R="1x"></1y>\');$(\'#1x\').7({2E:\'2H\',1u:\'2J\',1B:\'2L\',Y:\'2i%\'});$(\'#1x\').2M(\'2O.2P?2Q=2S&R=\'+$("#2T").o(\'2U\')+\'&2V=\'+2W,8(a){n.2l();n.2k()});4(2Z.30.31(/32 [0-6]\\./)){$(\'.34\').7({17:\'1F\'})}1G.38(\'#1x\');$(\'#39\').7({1d:\'1a\'});4($(2j).10()>$(\'#2h\').10()){u b=$(2j).10()}L{u b=$(\'#2h\').10()+2o}$(\'#2p\').7({10:b+\'D\'})}Q p})};5.2l=8(){4(r)s.t(\'q 1c\');u b=P($(\'#A\').7(\'10\').x(\'D\',\'\')),1I=0;4($(\'#A .16:2e\').F>0){1I=P($(\'#A .16:2e\').7(\'10\').x(\'D\',\'\'))}u c=1L.2b(b/2)-1L.2b(1I/2);$(\'#A .16\').29(\'<1y 1E="1P-1B:\'+c+\'D;28:1u;" />\');$(\'#A .1n\').29(\'<1y 1E="1P-1B:\'+c+\'D;28:1l;" />\');$(\'#3\').H(\'1T\');$(\'#3\').G(\'1T\',8(){4(r)s.t(\'#3 1T\');1m=p});$(\'#3\').H(\'1U\');$(\'#3\').G(\'1U\',8(){4(r)s.t(\'#3 1U\');1m=z});$(\'2F\').y(8(){4(1m&&1i(2G)==\'21\'){1G.20()}});u d=0,1h=P($(\'#3 .9\').7(\'Y\').x(\'D\',\'\'))+P($(\'#3 .9\').7(\'1P-1l\').x(\'D\',\'\'))+P($(\'#3 .9\').7(\'1Y-1u\').x(\'D\',\'\'))+P($(\'#3 .9\').7(\'1Y-1l\').x(\'D\',\'\'))+P($(\'#3 .9\').7(\'2a-1u-Y\').x(\'D\',\'\'))+P($(\'#3 .9\').7(\'2a-1l-Y\').x(\'D\',\'\')),1X=P($(\'#3\').7(\'Y\').x(\'D\',\'\'));d=$(\'#3 .9\').F*1h;4(1X<d){u e=1L.2N(1X/1h);d=e*1h}$(\'#1V\').7(\'Y\',d+\'D\');u f=0,13=0;$(\'.q .2R .Z\').1r(8(){4($(5).o(\'2m\').12(\'1z\')!=-1){f=13}13++});$(\'#A\').7(\'O-N\',\'M("\'+$(\'#3 .9 a\').V(f).o(\'E\')+\'")\');$(\'#3 .9\').V(f).T(\'K\');$(\'#3 .9 a\').H(\'y\');$(\'#3 .9 a\').G(\'y\',8(){4(r)s.t(\'#3 .9 a y\');$(\'#3 .9\').J(\'K\');$(5).1e().T(\'K\');u a=$(5).o(\'E\');$(\'#A\').7(\'O-N\',\'M("\'+a+\'")\');n.1f(z);Q p});$(\'#3 .C, #3 .C a\').2c(\'y\');$(\'#3 .C, #3 .C a\').y(8(){4(r)s.t(\'#3 .C, #3 .C a y\');u a=$(\'#A\').7(\'O-N\').x(\'M("\',\'\').x(\'")\',\'\'),1t=\'\',1K=33,14=p;$(\'#3 .9 a\').1r(8(){4(a.12($(5).o(\'E\'))!=-1){4(1t!=\'\'){$(\'#A\').7(\'O-N\',\'M("\'+1t+\'")\');$(\'#3 .9\').J(\'K\');$(1K).1e().T(\'K\');14=z}}L{1t=$(5).o(\'E\');1K=5}});4(14==p){$(\'#A\').7(\'O-N\',\'M("\'+$(\'#3 .9 a\').V($(\'#3 .9 a\').F-1).o(\'E\')+\'")\');$(\'#3 .9\').J(\'K\');$(\'#3 .9 a\').V($(\'#3 .9 a\').F-1).1e().T(\'K\')}n.1f(z);Q p});$(\'#3 .B, #3 .B a\').2c(\'y\');$(\'#3 .B, #3 .B a\').y(8(){4(r)s.t(\'#3 .B, #3 .B a y\');u a=$(\'#A\').7(\'O-N\').x(\'M("\',\'\').x(\'")\',\'\'),1v=p,14=p;$(\'#3 .9 a\').1r(8(){4(1v==z){$(\'#A\').7(\'O-N\',\'M("\'+$(5).o(\'E\')+\'")\');$(\'#3 .9\').J(\'K\');$(5).1e().T(\'K\');1v=p;14=z}4(a.12($(5).o(\'E\'))!=-1){1v=z}});4(14==p){$(\'#A\').7(\'O-N\',\'M("\'+$(\'#3 .9 a\').V(0).o(\'E\')+\'")\');$(\'#3 .9\').J(\'K\');$(\'#3 .9 a\').V(0).1e().T(\'K\')}n.1f(z);Q p});u g=p;$(\'#3 .C\').H(\'S\');$(\'#3 .C\').G(\'S\',8(){4(r)s.t(\'#3 .C S\');4(!g){$(\'.16\').T(\'1H\');$(\'.1n\').J(\'1D\')}});$(\'#3 .C\').H(\'X\');$(\'#3 .C\').G(\'X\',8(){4(r)s.t(\'#3 .C X\');$(\'.16\').J(\'1H\')});$(\'#3 .B\').H(\'S\');$(\'#3 .B\').G(\'S\',8(){4(r)s.t(\'#3 .B S\');g=z;$(\'.1n\').T(\'1D\');$(\'.16\').J(\'1H\')});$(\'#3 .B\').H(\'X\');$(\'#3 .B\').G(\'X\',8(){4(r)s.t(\'#3 .B X\');g=p;$(\'.1n\').J(\'1D\')});$(\'#3 .1C\').H(\'y\');$(\'#3 .1C\').G(\'y\',8(){4(r)s.t(\'#3 .1C y\');1G.20();Q p});n.1f(z)};5.1f=8(a){4(a==p){4($(\'#A\').7(\'O-N\').x(\'M("\',\'\').x(\'")\',\'\').12($(\'#3 .9 a\').V(0).o(\'E\'))!=-1){$(\'#3 .C\').7(\'17\',\'1F\')}L{$(\'#3 .C\').7(\'17\',\'1A\')}4($(\'#A\').7(\'O-N\').x(\'M("\',\'\').x(\'")\',\'\').12($(\'#3 .9 a\').V($(\'#3 .9 a\').F-1).o(\'E\'))!=-1){$(\'#3 .B\').7(\'17\',\'1F\')}L{$(\'#3 .B\').7(\'17\',\'1A\')}}L{4($(\'#1V .9\').F>1){$(\'#3 .C, #3 .B\').7(\'17\',\'1A\')}L{$(\'#1V\').1Z()}}};5.2k=8(){u a=1k 2D(),13=0;$(\'#3 .9 a\').1r(8(){a[13]=1k 24();a[13].1j=$(5).o(\'E\');13++})};5.1c()}',62,199,'|||lightbox_gallery|if|this||css|function|thumbnail|||||||||||||||attr|false|gallery|fb|console|log|var|inside|stage|replace|click|true|lightbox_gallery_main|lightbox_gallery_right|lightbox_gallery_left|px|href|length|live|die|info_image_box|removeClass|lightbox_thumbnail_active|else|url|image|background|Number|return|id|mouseover|addClass|crossslide|eq|html|mouseout|width|button_product_images|height|t_thumbnail_id|search|count_thumbnails|t_updated_image|t_images_array|icon_gallery_back|visibility|button_lightbox_gallery|t_active_image_id|none|show_image|init_binds|display|parent|update_navigation|title|t_thumbnail_width|typeof|src|new|right|t_close_lightbox|icon_gallery_next|t_wait|loading|show_image_after_delay|each|t_image_loaded|t_previous_image|left|t_current_image_reached|t_interval|lightbox_gallery_box|div|active_thumbnail|visible|top|icon_lightbox_close|icon_gallery_next_active|style|hidden|gmLightBox|icon_gallery_back_active|t_button_height|load_image|t_previous_element|Math|t_timeout|t_last_image_html|bind_thumbnails|margin|bind_zoom|bind_lightbox|gallery_inside_thumbnail_|mouseenter|mouseleave|lightbox_gallery_thumbnails|ButtonProductImagesHandler|t_gallery_width|padding|hide|close_box|undefined|jqzoom|gallery_inside_main_|Image|clearInterval|img|t_load_image|float|wrap|border|round|unbind|parseInt|first|rel|boolean|popup_box|100|document|preload|gallery_init_binds|class|substring|200|__dimScreen|js_options|global|dir_ws_images|product_images|clearTimeout|setTimeout|setInterval|alt|images|zoom_plugin|wrap_shop|append|NaN|Array|position|body|gm_style_edit_mode_running|absolute|500|0px|Object|60px|load|floor|request_port|php|module|thumbnails|LightboxGallery|gm_products_id|value|XTCsid|gm_session_id|closest|complete|navigator|appVersion|match|MSIE|null|lightbox_visibility_hidden|ready|find|cursor|load_box|menubox_gm_scroller|no|element|default'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function ButtonProductImagesHandler(p_lightbox, p_zoom, p_delay)
{
	if(fb)console.log('ButtonProductImagesHandler ready');

	var t_lightbox = true;
	if(typeof(p_lightbox) == 'boolean')
	{
		t_lightbox = p_lightbox;
	}
	var t_zoom = true;
	if(typeof(p_zoom) == 'boolean')
	{
		t_zoom = p_zoom;
	}
	var t_delay = 500;
	if(parseInt(p_delay) != 'NaN')
	{
		t_delay = parseInt(p_delay);
	}

	var coo_this = this;
	var t_interval = 0;
	var t_images_array = new Object();
	var t_close_lightbox = true;
	var t_wait = false;
	var t_timeout = 0;
	var t_active_image_id = '';
	var t_last_image_html = '';


	this.init_binds = function()
	{
		if(fb)console.log('ButtonProductImagesHandler init_binds');

		this.bind_thumbnails();
		if(t_zoom)
		{
			this.bind_zoom();
		}
		if(t_lightbox)
		{
			this.bind_lightbox();
		}
		else
		{
			$('.button_lightbox_gallery').die('click');
			$('.button_lightbox_gallery').live('click', function()
			{
				if(fb)console.log('.button_lightbox_gallery click');

				if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
				{
					coo_this.show_image(this);
				}

				return false;
			});
		}
	}


	this.bind_thumbnails = function()
	{
		if(fb)console.log('bind_thumbnails');

		var t_thumbnail_id = '';

		$('a.button_product_images').die('mouseover');
		$('a.button_product_images').live('mouseover', function()
		{
			if(fb)console.log('a.button_product_images mouseover: ' + $(this).attr('id'));

			$(this).attr('title', '');
			$(this).find('img').attr('title', '');

			if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
			{
				t_active_image_id = '#' + $(this).attr('id');

				if(t_wait == false)
				{
					coo_this.show_image(this);
				}

			}

			return false;
		});

		$('.button_product_images').die('mouseout');
		$('.button_product_images').live('mouseout', function()
		{
			clearInterval(t_interval);
			
			if($('.gallery .inside .stage .info_image_box').html() == 'loading...')
			{
				$('.gallery .inside .stage .info_image_box').html(t_last_image_html);
				coo_this.init_binds();
			}

			clearTimeout(t_timeout);
			t_active_image_id = '';
			t_wait = true;
			t_timeout = setTimeout(coo_this.show_image_after_delay, t_delay);

			t_thumbnail_id = $(this).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			$('.gallery .inside .stage #gallery_inside_main_' + t_thumbnail_id).closest('a').removeClass('jqzoom');


			return false;
		});
	}


	this.show_image_after_delay = function()
	{
		t_wait = false;

		if(t_active_image_id != '')
		{
			if(fb)console.log('show_image_after_delay(): ' + t_active_image_id);
			coo_this.show_image(t_active_image_id);
		}
		else
		{
			if(fb)console.log('show_image_after_delay(): no element');
		}
	}


	this.show_image = function(p_element)
	{
		if(typeof($(p_element).attr('id')) != 'undefined' && $(p_element).attr('id').search('gallery_inside_thumbnail_') != -1)
		{
			$('.gallery .inside .stage #crossslide').hide();

			$('a.button_product_images').removeClass('active_thumbnail');
			$(p_element).addClass('active_thumbnail');

			t_thumbnail_id = $(p_element).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			t_images_array[t_thumbnail_id] = new Image();

			t_images_array[t_thumbnail_id].src = $(p_element).attr('href');

			t_load_image = this.load_image(t_thumbnail_id, $(p_element).attr('rel'));

			if(t_load_image == false)
			{
				t_interval = setInterval(function(){coo_this.load_image(t_thumbnail_id, $(p_element).attr('rel'));}, 100);
			}
		}
	}


	this.load_image = function(p_id, p_zoom_url)
	{
		var c_id = Number(p_id);

		var t_image_loaded = true;
		if(t_images_array[c_id].complete != true)
		{
			t_image_loaded = false;
		}

		if(t_image_loaded)
		{
			clearInterval(t_interval);

			var t_style = '';
			if(t_lightbox == false)
			{
				t_style = ' style="cursor: default;"';
			}

			// create relative image path, to avoid problems with umlaut domains
			var t_image_url = t_images_array[c_id].src;
			t_image_url = t_image_url.substring(t_image_url.search(js_options.global.dir_ws_images + 'product_images'), t_image_url.length);

			$('.gallery .inside .stage .info_image_box').css('width', t_images_array[c_id].width + 'px');
			$('.gallery .inside .stage .info_image_box').html('<a class="jqzoom" href="' + p_zoom_url + '"' + t_style + ' title=""><img id="gallery_inside_main_' + c_id + '" src="' + t_image_url + '" alt="" title="" /></a>');

			if(t_zoom)
			{
				this.bind_zoom();
			}
		}
		else
		{
			if($('.gallery .inside .stage .info_image_box').html() != 'loading...')
			{
				t_last_image_html = $('.gallery .inside .stage .info_image_box').html();
			}
			$('.gallery .inside .stage .info_image_box').html('loading...');
			if(fb)console.log('loading images...');
		}

		return t_image_loaded;
	}


	this.bind_zoom = function()
	{
    
		if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
		{
			// workaround for chrome browser
			$('.gallery .inside .stage .info_image_box').html($('.gallery .inside .stage .info_image_box').html());

			if($(".info_image_box").length > 0)
			{
				$(".info_image_box").zoom_plugin();
			}
		}
	}


	this.bind_lightbox = function()
	{
		if(fb)console.log('bind_lightbox');

		$('.button_lightbox_gallery').die('click');
		$('.button_lightbox_gallery').live('click', function()
		{
			if(fb)console.log('.button_lightbox_gallery click');

			if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
			{
				coo_this.show_image(this);
			}
			else if($('.gallery .inside .stage .info_image_box').length > 0)
			{
				$('.wrap_shop').append('<div id="lightbox_gallery_box"></div>');

				$('#lightbox_gallery_box').css(
				{
					position: 	'absolute',
					left: 			'0px',
					top: 				'60px',
					width: 			'100%'
				});

				$('#lightbox_gallery_box').load('request_port.php?module=LightboxGallery&id=' + $("#gm_products_id").attr('value') + '&XTCsid=' + gm_session_id,
					function(lightbox_gallery)
					{
						coo_this.gallery_init_binds();
						coo_this.preload();
					}
				);

				if (navigator.appVersion.match(/MSIE [0-6]\./)) {
					$('.lightbox_visibility_hidden').css(
					{
						visibility: 	'hidden'
					});
				}

				gmLightBox.load_box('#lightbox_gallery_box');
				// BOF MOD by PT
				$('#menubox_gm_scroller').css({
					display: 'none'
				});

				if($(document).height() > $('#popup_box').height()) {
					var pt_height = $(document).height();
				} else {
					var pt_height = $('#popup_box').height() + 200;
				}
				$('#__dimScreen').css({height: pt_height + 'px'});
				// EOF MOD by PT
			}

			return false;
		});
	}

	this.gallery_init_binds = function()
	{
		if(fb)console.log('gallery init_binds');

		var t_main_height = Number($('#lightbox_gallery_main').css('height').replace('px', ''));
		var t_button_height = 0;
		if($('#lightbox_gallery_main .icon_gallery_back:first').length > 0)
		{
			t_button_height = Number($('#lightbox_gallery_main .icon_gallery_back:first').css('height').replace('px', ''));
		}
		var t_margin_top = Math.round(t_main_height / 2) - Math.round(t_button_height / 2);

		$('#lightbox_gallery_main .icon_gallery_back').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:left;" />');
		$('#lightbox_gallery_main .icon_gallery_next').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:right;" />');

		$('#lightbox_gallery').die('mouseenter');
		$('#lightbox_gallery').live('mouseenter', function()
		{
			if(fb)console.log('#lightbox_gallery mouseenter');

			t_close_lightbox = false;
		});

		$('#lightbox_gallery').die('mouseleave');
		$('#lightbox_gallery').live('mouseleave', function()
		{
			if(fb)console.log('#lightbox_gallery mouseleave');

			t_close_lightbox = true;
		});

		$('body').click(function()
		{
			if(t_close_lightbox && typeof(gm_style_edit_mode_running) == 'undefined')
			{
				gmLightBox.close_box();
			}
		});

		// centering thumbnails
		var t_thumbnails_width = 0;
		var t_thumbnail_width = Number($('#lightbox_gallery .thumbnail').css('width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('margin-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-left').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-left-width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-right-width').replace('px', ''));
		var t_gallery_width = Number($('#lightbox_gallery').css('width').replace('px', ''));
		t_thumbnails_width = $('#lightbox_gallery .thumbnail').length * t_thumbnail_width;
		if(t_gallery_width < t_thumbnails_width)
		{
			var t_thumbnails_per_row = Math.floor(t_gallery_width / t_thumbnail_width);
			t_thumbnails_width = t_thumbnails_per_row * t_thumbnail_width;
		}
		$('#lightbox_gallery_thumbnails').css('width', t_thumbnails_width + 'px');

		var t_active_image = 0;
		var count_thumbnails = 0;
		$('.gallery .thumbnails .button_product_images').each(function()
		{
			if($(this).attr('class').search('active_thumbnail') != -1)
			{
				t_active_image = count_thumbnails;
			}

			count_thumbnails++;
		});

		$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq(t_active_image).attr('href') + '")');
		$('#lightbox_gallery .thumbnail').eq(t_active_image).addClass('lightbox_thumbnail_active');

		$('#lightbox_gallery .thumbnail a').die('click');
		$('#lightbox_gallery .thumbnail a').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .thumbnail a click');

			$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
			$(this).parent().addClass('lightbox_thumbnail_active');

			var t_popup_image_url = $(this).attr('href');
			$('#lightbox_gallery_main').css('background-image', 'url("' + t_popup_image_url + '")');

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a click');

			var t_current_image = $('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '');
			var t_previous_image = '';
			var t_previous_element = null;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				if(t_current_image.search($(this).attr('href').split('?')[0]) != -1)
				{
					if(t_previous_image != '')
					{
						$('#lightbox_gallery_main').css('background-image', 'url("' + t_previous_image + '")');

						$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
						$(t_previous_element).parent().addClass('lightbox_thumbnail_active');

						t_updated_image = true;
					}
				}
				else
				{
					t_previous_image = $(this).attr('href');
					t_previous_element = this;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).attr('href') + '")');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a click');

			var t_current_image = $('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '');
			var t_current_image_reached = false;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				if(t_current_image_reached == true)
				{
					$('#lightbox_gallery_main').css('background-image', 'url("' + $(this).attr('href') + '")');

					$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
					$(this).parent().addClass('lightbox_thumbnail_active');

					t_current_image_reached = false;
					t_updated_image = true;
				}

				if(t_current_image.search($(this).attr('href').split('?')[0]) != -1)
				{
					t_current_image_reached = true;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq(0).attr('href') + '")');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq(0).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		var t_right_mouseover = false;

		// BOF previous image
		$('#lightbox_gallery .lightbox_gallery_left').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseover');

			if(!t_right_mouseover)
			{
				$('.icon_gallery_back').addClass('icon_gallery_back_active');
				$('.icon_gallery_next').removeClass('icon_gallery_next_active');
			}
		});

		$('#lightbox_gallery .lightbox_gallery_left').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseout');

			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});
		// EOF previous image

		// BOF next image
		$('#lightbox_gallery .lightbox_gallery_right').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseover');

			t_right_mouseover = true;

			$('.icon_gallery_next').addClass('icon_gallery_next_active');
			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});

		$('#lightbox_gallery .lightbox_gallery_right').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseout');

			t_right_mouseover = false;

			$('.icon_gallery_next').removeClass('icon_gallery_next_active');
		});
		// EOF next image

		// BOF close
		$('#lightbox_gallery .icon_lightbox_close').die('click');
		$('#lightbox_gallery .icon_lightbox_close').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .icon_lightbox_close click');

			gmLightBox.close_box();

			return false;
		});
		// EOF close

		coo_this.update_navigation(true);
	}


	this.update_navigation = function(p_loop)
	{
		if(p_loop == false)
		{
			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq(0).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'visible');
			}

			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length-1).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
		}
		else
		{
			if($('#lightbox_gallery_thumbnails .thumbnail').length > 1)
			{
				$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
			else
			{
				$('#lightbox_gallery_thumbnails').hide();
			}
		}
	}

	this.preload = function()
	{
		var t_images = new Array();
		var count_thumbnails = 0;

		$('#lightbox_gallery .thumbnail a').each(function()
		{
			t_images[count_thumbnails] = new Image();
			t_images[count_thumbnails].src = $(this).attr('href');

			count_thumbnails++;
		});
	}

	this.init_binds();
}
/*<?php
}
?>*/
