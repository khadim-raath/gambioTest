/* SubmenuHandler.js <?php
#   --------------------------------------------------------------
#   SubmenuHandler.js 2016-02-17
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2016 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('9 U(f,g){4(B)C.D(\'U 1U\');3.1h=1V;4(p(f)!=\'r\'){3.1h=3.Q(f)}3.1i=1G;4(p(g)!=\'r\'){3.1i=3.Q(g)}3.K=1j();3.1k=1G;n h=3,E=1j(),1l=0,13=0,1m=\'\',19=y,1a=F;3.1n=9(){4(B)C.D(\'U 1n\');4(p 1H!=\'r\'){3.1o();1W.1I=$.1X([],1H);3.1p();3.K=3.V(0,3.K);3.1J();$(\'.1b\').W(\'X\',h.14);$(\'.1b\').15(\'X\',9(){h.14(F)});$(\'.5 l 1q\').W(\'X\',h.1r);$(\'.5 l 1q\').15(\'X\',h.1r);$(\'.5 l\').W(\'1s\');$(\'.5 l\').15(\'1s\',9(){4(B)C.D(\'.5 l 1s\');$(3).G(\'a\').x(\'1Y\',\'\');1a=y;1c(13);1m=$(3).x(\'1K-1Z\');n a=3;4(19==F){1l=1L(9(){h.1t(a)},h.1h)}J{4(B)C.D(\'U 20 21\');h.1t(a)}});$(\'.5 l\').W(\'Y\');$(\'.5 l\').15(\'Y\',9(){4(B)C.D(\'.5 l Y\');1c(1l);1m=\'\'});$(\'.5\').W(\'Y\');$(\'.5\').15(\'Y\',9(){4(B)C.D(\'.5 Y\');1a=F;4(p(22)==\'r\'){13=1L(h.14,h.1i)}})}};3.1t=9(a){4(p($(a).j(\'.5\').x(\'m\'))!=\'r\'){n b=0;4($(a).j(\'.5\').x(\'m\').O(\'s\')!=-1){b=$(a).j(\'.5\').x(\'m\').u(\'s\',\'\')}4(B)C.D(\'.5 l: 23 \'+b);4(b==0){$(\'.24-25.26.5 H l a.A\').Z(\'A\')}J{$(\'#s\'+b+\' H l a.A\').Z(\'A\')}$(a).G(\'a\').L(\'A\');n c=0;4($(a).x(\'m\').O(\'q\')!=-1){c=$(a).x(\'m\').u(\'q\',\'\')}4(B)C.D(\'.5 l: 1M \'+c);h.1N(b,c)}};3.1N=9(b,c){16=3.Q(b);1u=3.Q(c);n d=3.17(16,3.K);4(d==y){27.28({1K:\'29=2a&m=\'+16+\'&2b=\'+2c,2d:\'2e.2f\',2g:"2h",2i:F,2j:9(a){d=h.17(16,h.K);4(d==y){$(\'.1b:o\').2k(a);h.1o();h.K=h.V(16,h.K)}h.1v(1u);h.1p()}}).2l}J{h.1v(1u)}};3.1p=9(){$.1w(1I,9(i,e){4(2m(e)!==2n.2o.1M){4($(\'.1O\').P<=0){$(\'#q\'+e+\'\').L(\'1d\')}$(\'#1P\'+e+\'\').L(\'1d\');4($(\'#10\'+e+\'\').1Q(\'H\').P>0){$(\'#10\'+e+\'\').L(\'1d\')}J{$(\'#10\'+e+\'\').j(\'l\').L(\'1d\')}}J{4($(\'.1O\').P<=0){$(\'#q\'+e+\'\').L(\'1e\')}$(\'#1P\'+e+\'\').L(\'1e\');4($(\'#10\'+e+\'\').1Q(\'H\').P>0){$(\'#10\'+e+\'\').L(\'1e\')}J{$(\'#10\'+e+\'\').j(\'l\').L(\'1e\')}}})};3.1v=9(a){4(p(a)==\'r\'||a==0||11(a)){R y}3.1k++;n b=$(\'#q\'+a).1R().M,1f=$(\'#q\'+a).1R().N+2p.2q(\'q\'+a).2r,1g=0;4(p($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'1x-M-S\'))!=\'r\'){4(11($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'1x-M-S\').u(\'w\',\'\'))){1g=0}J{1g=I($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'1x-M-S\').u(\'w\',\'\'))}}b-=1g;n c=0;4(p($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'t-M\'))!=\'r\'){4(11($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'t-M\').u(\'w\',\'\'))){c=0}J{c=I($(\'.5[m^="s"]:o\').G(\'v:o\').8(\'t-M\').u(\'w\',\'\'))}}b-=c;n d=0;4(p($(\'#q\'+a).j(\'v\').8(\'t-M\'))!=\'r\'){d=I($(\'#q\'+a).j(\'v\').8(\'t-N\').u(\'w\',\'\'))}n e=0;4(p($(\'#q\'+a).j(\'v\').8(\'t-2s\'))!=\'r\'){e=I($(\'#q\'+a).j(\'v\').8(\'t-T\').u(\'w\',\'\'))}1f+=d+e-2;4(3.1y(a)==y){1f+=7}$(\'#s\'+a).j(\'.k\').8({\'z-18\':3.1k,M:b,N:1f});3.1S();3.1z(a);1A(n i=0;i<E.P;i++){4(B)C.D(E[i])}3.1T(a)};3.1T=9(a){n b=3.Q(a);$(\'#s\'+b).j(\'.k\').2t();E=3.V(\'s\'+b,E);$(\'.5\').1w(9(){4($(3).x(\'m\')!=\'\'&&h.17($(3).x(\'m\'),E)==y){$(3).j(\'.k\').1B();$(3).G(\'H l a.A\').Z(\'A\')}});19=y;n c=0;4(p($(\'#q\'+b).j(\'.k\').8(\'z-18\'))!=\'r\'&&$(\'#q\'+b).j(\'.k\').8(\'z-18\')!=\'2u\'){c=I($(\'#q\'+b).j(\'.k\').8(\'z-18\'))}1A(n i=0;i<E.P;i++){4(c<($(\'#\'+E[i]).j(\'.k\').8(\'z-18\'))){$(\'#\'+E[i]+\' H l a.A\').Z(\'A\');19=F}}};3.1z=9(a){n b=3.Q(a);4($(\'#q\'+b).j(\'.5\').x(\'m\')!=\'\'){n c=$(\'#q\'+b).j(\'.5\').x(\'m\');4(p(c)!=\'r\'){E=3.V(c,E);1C=c.u(\'s\',\'\');4(1C!=\'0\'){3.1z(1C)}}}};3.1S=9(){E=1j()};3.17=9(a,b){n c=y;1A(n i=0;i<b.P;i++){4(b[i]==a){c=F;2v}}R c};3.V=9(a,b){4(3.17(a,b)==y){b.2w(a)}R b};3.Q=9(a){1D=0;4(p(a)!=\'r\'||11(a)==y){1D=I(a)}R 1D};3.14=9(a){4(B)C.D(\'U 14\');4(p(a)==\'r\'){a=y}4(a==F){4(1a==F){1c(13);$(\'.5[m^="s"]\').j(\'.k\').1B();$(\'.5 H l a.A\').Z(\'A\');$(\'.1b\').W(\'X\',3)}}J{1c(13);$(\'.5[m^="s"]\').j(\'.k\').1B();$(\'.5 H l a.A\').Z(\'A\')}};3.1y=9(a){n b=y,12=0;4(11(a)){12=a.u(/[^\\d]+/g,\'\');4(11(12)){4(B)C.D(\'U 1y(): 2x 2y "\'+a+\'"\');R y}}J{12=a}4(p($(\'#q\'+12).j(\'.5\'))==\'2z\'&&$(\'#q\'+12).j(\'.5\').x(\'m\').O(\'s\')!=-1){b=F}R b};3.1J=9(){n a=\'\',1E=\'\';$(\'v[m^="s"]\').1w(9(){a=$(3).x(\'m\').u(\'s\',\'\');4($(\'#q\'+a).P>0){1E=$(\'#q\'+a).j(\'.5\').x(\'m\').u(\'s\',\'\');h.K=h.V(1E,h.K)}})};3.1r=9(){4(B)C.D(\'.5 l 1q X, 2A 2B: \'+$(3).j(\'l\').G(\'a:o\').x(\'1F\'));2C.1F=$(3).j(\'l\').G(\'a:o\').x(\'1F\');R F};3.1o=9(){4(2D.2E.2F(/2G [0-6]\\./)){n a=0;4(p($(\'.k .5\').8(\'t-N\'))!=\'r\'&&$(\'.k .5\').8(\'t-N\').O(\'w\')!=-1){a+=I($(\'.k .5\').8(\'t-N\').u(\'w\',\'\'))}4(p($(\'.k .5\').8(\'t-T\'))!=\'r\'&&$(\'.k .5\').8(\'t-T\').O(\'w\')!=-1){a+=I($(\'.k .5\').8(\'t-T\').u(\'w\',\'\'))}4(p($(\'.k .5 v:o\').8(\'t-N\'))!=\'r\'&&$(\'.k .5 v:o\').8(\'t-N\').O(\'w\')!=-1){a+=I($(\'.k .5 v:o\').8(\'t-N\').u(\'w\',\'\'))}4(p($(\'.k .5 v:o\').8(\'t-T\'))!=\'r\'&&$(\'.k .5 v:o\').8(\'t-T\').O(\'w\')!=-1){a+=I($(\'.k .5 v:o\').8(\'t-T\').u(\'w\',\'\'))}4(p($(\'.k .5 H l\').8(\'S\'))!=\'r\'&&$(\'.k .5 H l\').8(\'S\').O(\'w\')!=-1){n b=I($(\'.k .5 H l\').8(\'S\').u(\'w\',\'\'));b+=a;$(\'.k\').8(\'S\',b+\'w\')}}};3.1n()}',62,167,'|||this|if|submenu|||css|function||||||||||closest|submenu_container|li|id|var|first|typeof|menu_cat_id_|undefined|submenu_box_id_|padding|replace|div|px|attr|false||active|fb|console|log|v_visible_menu_ids_array|true|find|ul|Number|else|v_parent_ids_array|addClass|top|left|search|length|clear_number|return|width|right|SubmenuHandler|push_id|die|click|mouseleave|removeClass|megadropdown_top_link_id_|isNaN|c_parent_id|v_timeout_close|close_all|live|c_parents_id|in_array|index|v_inactive_submenus_shown|v_allow_close_all|wrap_shop|clearTimeout|parentOfCurrent|current|t_left|t_border_top_width|v_delay_open|v_delay_close|Array|v_z_index|v_timeout_open|v_active_element|init_binds|ie6_fix|setCurrentsClasses|img|open_link|mouseenter|open_menu|c_categories_id|load_submenu|each|border|is_submenu|set_visible_menu_ids|for|hide|t_categories_id|c_number|parent_id|href|500|parentsIds|parentsIdsBak|find_loaded_submenus|data|setTimeout|categories_id|get_submenus_by_categories_id|cat_go_up_button|megadropdown_|next|offset|reset_visible_menu_ids|show_submenu|ready|250|window|extend|title|menu_id|open_delay|ignored|gm_style_edit_mode_running|parents_id|content|box|categories|jQuery|ajax|module|Submenus|XTCsid|gm_session_id|url|request_port|php|type|GET|async|success|prepend|html|parseInt|js_options|global|document|getElementById|offsetWidth|bottom|show|auto|break|push|wrong|parameter|object|open|link|location|navigator|appVersion|match|MSIE'.split('|'),0,{}))
/*<?php
}
else
{
?>*/
function SubmenuHandler(p_delay_open, p_delay_close)
{
    if(fb)console.log('SubmenuHandler ready');
    
	this.v_delay_open = 250; // unit: ms
	if(typeof(p_delay_open) != 'undefined')
	{
		this.v_delay_open = this.clear_number(p_delay_open);
	}

	this.v_delay_close = 500; // unit: ms
	if(typeof(p_delay_close) != 'undefined')
	{
		this.v_delay_close = this.clear_number(p_delay_close);
	}

	this.v_parent_ids_array = Array();
	this.v_z_index = 500;
	var coo_this = this;
	var v_visible_menu_ids_array = Array();
	var v_timeout_open = 0;
	var v_timeout_close = 0;
	var v_active_element = '';
	var v_inactive_submenus_shown = false;
	var v_allow_close_all = true;


	this.init_binds = function()
	{
		if(fb)console.log('SubmenuHandler init_binds');
		
		if(typeof parentsIds != 'undefined') {
			this.ie6_fix();
			window.parentsIdsBak = $.extend([], parentsIds);
			this.setCurrentsClasses();
			
			this.v_parent_ids_array = this.push_id(0, this.v_parent_ids_array);
			this.find_loaded_submenus();
			
			$('.wrap_shop').die('click', coo_this.close_all);
			$('.wrap_shop').live('click', function() {
				coo_this.close_all(true)
			});
			
			$('.submenu li img').die('click', coo_this.open_link);
			$('.submenu li img').live('click', coo_this.open_link);
			
			$('.submenu li').die('mouseenter');
			$('.submenu li').live('mouseenter', function() {
				if (fb)console.log('.submenu li mouseenter');
				
				// clear title obscuring the menu
				$(this).find('a').attr('title', '');
				
				v_allow_close_all = false;
				
				clearTimeout(v_timeout_close);
				
				v_active_element = $(this).attr('data-menu_id');
				
				var t_coo_this = this;
				
				if (v_inactive_submenus_shown == true) {
					v_timeout_open = setTimeout(function() {
						coo_this.open_menu(t_coo_this)
					}, coo_this.v_delay_open);
				}
				// ignore open_delay if there are no submenus that could be left accidentally
				else {
					if (fb)console.log('SubmenuHandler open_delay ignored')
					coo_this.open_menu(t_coo_this);
				}
			});
			
			$('.submenu li').die('mouseleave');
			$('.submenu li').live('mouseleave', function() {
				if (fb)console.log('.submenu li mouseleave');
				
				clearTimeout(v_timeout_open);
				v_active_element = '';
			});
			
			$('.submenu').die('mouseleave');
			$('.submenu').live('mouseleave', function() {
				if (fb)console.log('.submenu mouseleave');
				
				v_allow_close_all = true;
				
				if (typeof(gm_style_edit_mode_running) == 'undefined') {
					v_timeout_close = setTimeout(coo_this.close_all, coo_this.v_delay_close);
				}
			});
		}
	}


	this.open_menu = function(p_coo_this)
	{
		if(typeof($(p_coo_this).closest('.submenu').attr('id')) != 'undefined')
		{
			var t_parents_id = 0;
			if($(p_coo_this).closest('.submenu').attr('id').search('submenu_box_id_') != -1)
			{
				t_parents_id = $(p_coo_this).closest('.submenu').attr('id').replace('submenu_box_id_', '');
			}
			if(fb)console.log('.submenu li: parents_id ' + t_parents_id);

			if(t_parents_id == 0)
			{
				$('.content-box.categories.submenu ul li a.active').removeClass('active');
			}
			else
			{
				$('#submenu_box_id_' + t_parents_id + ' ul li a.active').removeClass('active');

			}
			$(p_coo_this).find('a').addClass('active');

			var t_categories_id = 0;
			if($(p_coo_this).attr('id').search('menu_cat_id_') != -1)
			{
				t_categories_id = $(p_coo_this).attr('id').replace('menu_cat_id_', '');
			}
			if(fb)console.log('.submenu li: categories_id ' + t_categories_id);

			coo_this.get_submenus_by_categories_id(t_parents_id, t_categories_id);
		}
	}


	this.get_submenus_by_categories_id = function(p_parents_id, p_categories_id)
	{
		c_parents_id = this.clear_number(p_parents_id);
		c_categories_id = this.clear_number(p_categories_id);

		var t_already_loaded = this.in_array(c_parents_id, this.v_parent_ids_array);

		if(t_already_loaded == false)
		{
			jQuery.ajax(
			{
				data:		'module=Submenus&id=' + c_parents_id  + '&XTCsid=' + gm_session_id,
				url: 		'request_port.php',
				type: 		"GET",
				async:		true,
				success:	function(t_submenus_html)
				{
					t_already_loaded = coo_this.in_array(c_parents_id, coo_this.v_parent_ids_array);
					if(t_already_loaded == false)
					{
						$('.wrap_shop:first').prepend(t_submenus_html);
						coo_this.ie6_fix();
						coo_this.v_parent_ids_array = coo_this.push_id(c_parents_id, coo_this.v_parent_ids_array);
					}
					coo_this.load_submenu(c_categories_id);
                    coo_this.setCurrentsClasses();
				}
			}).html;
		}
		else
		{
			coo_this.load_submenu(c_categories_id);
		}

	}
    
    this.setCurrentsClasses = function()
    {
        $.each(parentsIdsBak, function(i, e){
            if(parseInt(e) !== js_options.global.categories_id)
            {
                if($('.cat_go_up_button').length <= 0)
                {
                    $('#menu_cat_id_' + e + '').addClass('parentOfCurrent');
                }
                $('#megadropdown_' + e + '').addClass('parentOfCurrent');
                if($('#megadropdown_top_link_id_' + e + '').next('ul').length > 0)
                {
                    $('#megadropdown_top_link_id_' + e + '').addClass('parentOfCurrent');
                }
                else
                {
                    $('#megadropdown_top_link_id_' + e + '').closest('li').addClass('parentOfCurrent');
                }
            }
            else
            {
                if($('.cat_go_up_button').length <= 0)
                {
                    $('#menu_cat_id_' + e + '').addClass('current');
                }
                $('#megadropdown_' + e + '').addClass('current');
                if($('#megadropdown_top_link_id_' + e + '').next('ul').length > 0)
                {
                    $('#megadropdown_top_link_id_' + e + '').addClass('current');
                }
                else
                {
                    $('#megadropdown_top_link_id_' + e + '').closest('li').addClass('current');
                }
            }
        });
    }


	this.load_submenu = function(p_categories_id)
	{
		if(typeof(p_categories_id) == 'undefined' || p_categories_id == 0 || isNaN(p_categories_id))
		{
			return false;
		}

		this.v_z_index++;

		var t_top = $('#menu_cat_id_' + p_categories_id).offset().top;
		var t_left = $('#menu_cat_id_' + p_categories_id).offset().left + document.getElementById('menu_cat_id_' + p_categories_id).offsetWidth;

		var t_border_top_width = 0;
		if(typeof($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width')) != 'undefined')
		{
			if(isNaN($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width').replace('px', '')))
			{
				t_border_top_width = 0;
			}
			else
			{
				t_border_top_width = Number($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width').replace('px', ''));
			}

		}
		t_top -= t_border_top_width;

		var t_padding_top = 0;
		if(typeof($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top')) != 'undefined')
		{
			if(isNaN($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top').replace('px', '')))
			{
				t_padding_top = 0;
			}
			else
			{
				t_padding_top = Number($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top').replace('px', ''));
			}
		}
		t_top -= t_padding_top;

		var t_padding_left = 0;
		if(typeof($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-top')) != 'undefined')
		{
			t_padding_left = Number($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-left').replace('px', ''));
		}
		var t_padding_right = 0;
		if(typeof($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-bottom')) != 'undefined')
		{
			t_padding_right = Number($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-right').replace('px', ''));
		}
		t_left += t_padding_left + t_padding_right - 2;

		if(this.is_submenu(p_categories_id) == false)
		{
			t_left += 7;
		}

		$('#submenu_box_id_' + p_categories_id).closest('.submenu_container').css(
		{
			'z-index': this.v_z_index,
			top: t_top,
			left: t_left
		});

		this.reset_visible_menu_ids();
		this.set_visible_menu_ids(p_categories_id);

		for(var i = 0; i < v_visible_menu_ids_array.length; i++)
		{
			if(fb)console.log(v_visible_menu_ids_array[i]);
		}

		this.show_submenu(p_categories_id);
	}


	this.show_submenu = function(p_categories_id)
	{
		var c_categories_id = this.clear_number(p_categories_id);

		$('#submenu_box_id_' + c_categories_id).closest('.submenu_container').show();
		v_visible_menu_ids_array = this.push_id('submenu_box_id_' + c_categories_id, v_visible_menu_ids_array);

		// hide menus not belonging to the last opened menu
		$('.submenu').each(function()
		{
			if($(this).attr('id') != '' && coo_this.in_array($(this).attr('id'), v_visible_menu_ids_array) == false)
			{
				$(this).closest('.submenu_container').hide();

				// reset styles
				$(this).find('ul li a.active').removeClass('active');
			}
		});

		// remove highlight-class (active) from submenus of current hovered menu entry
		v_inactive_submenus_shown = false;

		var current_z_index = 0;
		if(typeof($('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index')) != 'undefined' && $('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index') != 'auto')
		{
			current_z_index = Number($('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index'));
		}

		for(var i = 0; i < v_visible_menu_ids_array.length; i++)
		{
			if(current_z_index < ($('#' + v_visible_menu_ids_array[i]).closest('.submenu_container').css('z-index')))
			{
				$('#' + v_visible_menu_ids_array[i] + ' ul li a.active').removeClass('active');
				v_inactive_submenus_shown = true;
			}
		}
	}


	this.set_visible_menu_ids = function(p_categories_id)
	{
		var c_categories_id = this.clear_number(p_categories_id);

		if($('#menu_cat_id_' + c_categories_id).closest('.submenu').attr('id') != '')
		{
			var t_submenu_box_id = $('#menu_cat_id_' + c_categories_id).closest('.submenu').attr('id');
			
			if(typeof(t_submenu_box_id) != 'undefined')
			{
				v_visible_menu_ids_array = this.push_id(t_submenu_box_id, v_visible_menu_ids_array);

				t_categories_id = t_submenu_box_id.replace('submenu_box_id_', '');

				if(t_categories_id != '0')
				{
					this.set_visible_menu_ids(t_categories_id);
				}
			}
		}
	}


	this.reset_visible_menu_ids = function()
	{
		v_visible_menu_ids_array = Array();
	}


	this.in_array = function(p_needle, p_haystack_array)
	{
		var t_found = false;
		for(var i = 0; i < p_haystack_array.length; i++)
		{
			if(p_haystack_array[i] == p_needle)
			{
				t_found = true;
				break;
			}
		}

		return t_found;
	}


	this.push_id = function(p_id, p_array)
	{
		if(this.in_array(p_id, p_array) == false)
		{
			p_array.push(p_id);
		}

		return p_array;
	}


	this.clear_number = function(p_number)
	{
		c_number = 0;

		if(typeof(p_number) != 'undefined' || isNaN(p_number) == false)
		{
			c_number = Number(p_number);
		}

		return c_number;
	}


	this.close_all = function(p_close_by_click)
	{
		if(fb)console.log('SubmenuHandler close_all');

		if(typeof(p_close_by_click) == 'undefined')
		{
			p_close_by_click = false;
		}

		if(p_close_by_click == true)
		{
			if(v_allow_close_all == true)
			{
				clearTimeout(v_timeout_close);

				$('.submenu[id^="submenu_box_id_"]').closest('.submenu_container').hide();
				$('.submenu ul li a.active').removeClass('active');
				$('.wrap_shop').die('click', this);
			}
		}
		else
		{
			clearTimeout(v_timeout_close);

			$('.submenu[id^="submenu_box_id_"]').closest('.submenu_container').hide();
			$('.submenu ul li a.active').removeClass('active');
		}
	}


	this.is_submenu = function(p_parent_id)
	{
		var t_is_submenu = false;
		var c_parent_id = 0;

		if(isNaN(p_parent_id))
		{
			c_parent_id = p_parent_id.replace(/[^\d]+/g, '');
			if(isNaN(c_parent_id))
			{
				if(fb)console.log('SubmenuHandler is_submenu(): wrong parameter "' + p_parent_id + '"');
				return false;
			}
		}
		else
		{
			c_parent_id = p_parent_id;
		}

		// check if it is a submenu
		if(typeof($('#menu_cat_id_' + c_parent_id).closest('.submenu')) == 'object'
			&& $('#menu_cat_id_' + c_parent_id).closest('.submenu').attr('id').search('submenu_box_id_') != -1)
		{
			t_is_submenu = true;
		}

		return t_is_submenu;
	}


	this.find_loaded_submenus = function()
	{
		var submenu_box_id = '';
		var parent_id = '';

		$('div[id^="submenu_box_id_"]').each(function()
		{
			submenu_box_id = $(this).attr('id').replace('submenu_box_id_', '');
			if($('#menu_cat_id_' + submenu_box_id).length > 0)
			{
				parent_id = $('#menu_cat_id_' + submenu_box_id).closest('.submenu').attr('id').replace('submenu_box_id_', '');
				coo_this.v_parent_ids_array = coo_this.push_id(parent_id, coo_this.v_parent_ids_array);
			}
		});
	}


	this.open_link = function()
	{
		if(fb)console.log('.submenu li img click, open link: ' + $(this).closest('li').find('a:first').attr('href'));
		location.href = $(this).closest('li').find('a:first').attr('href');

		return true;
	}


	// IE6 needs fixed width for outer div-block '.submenu_container' calculated by inner div-blocks paddings
	// ('.submenu', '.submenu div:first') and width of '.submenu ul li' (only set in IE6)
	this.ie6_fix = function()
	{
		if(navigator.appVersion.match(/MSIE [0-6]\./))
		{
			var t_paddings = 0;
			if(typeof($('.submenu_container .submenu').css('padding-left')) != 'undefined'
				&& $('.submenu_container .submenu').css('padding-left').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu').css('padding-left').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu').css('padding-right')) != 'undefined'
				&& $('.submenu_container .submenu').css('padding-right').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu').css('padding-right').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu div:first').css('padding-left')) != 'undefined'
				&& $('.submenu_container .submenu div:first').css('padding-left').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu div:first').css('padding-left').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu div:first').css('padding-right')) != 'undefined'
				&& $('.submenu_container .submenu div:first').css('padding-right').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu div:first').css('padding-right').replace('px', ''));
			}

			if(typeof($('.submenu_container .submenu ul li').css('width')) != 'undefined'
				&& $('.submenu_container .submenu ul li').css('width').search('px') != -1)
			{
				var t_width = Number($('.submenu_container .submenu ul li').css('width').replace('px', ''));
				t_width += t_paddings;
				$('.submenu_container').css('width', t_width + 'px');
			}
		}
	}


	this.init_binds();
}
/*<?php
}
?>*/

