"use strict";jse.libs.modal=jse.libs.modal||{},function(t){function e(t){jse.core.debug.warn("Used deprecated modal method "+t+" which will be removed in JSE v1.5.")}var a={yes:{name:jse.core.lang.translate("yes","buttons"),type:"success"},no:{name:jse.core.lang.translate("no","buttons"),type:"fail"},abort:{name:jse.core.lang.translate("abort","buttons"),type:"fail"},ok:{name:jse.core.lang.translate("ok","buttons"),type:"success"},close:{name:jse.core.lang.translate("close","buttons"),type:"fail"}},n=function(t,e){var a=t.filter("form").add(t.find("form")),n={},o=[];return a.length&&a.each(function(){var t=$(this);if(e){var a=$.Deferred();o.push(a),t.trigger("validator.validate",{deferred:a})}var l=t.attr("name")||t.attr("id")||"form_"+(new Date).getTime()*Math.random();n[l]=window.jse.lib.form.getData(t)}),$.when.apply(void 0,o).then(function(){return n},function(){return n}).promise()},o=function(t,e){n(t).always(function(a){e.reject(a),t.dialog("close").remove()})},l=function(t,e){n(t,!0).done(function(a){e.resolve(a),t.dialog("close").remove()})},s=function(t,e){var a=[],n=null;return t&&$.each(t,function(t,s){n={},n.text=s.name||"BUTTON",n.click=function(){var t=$(this);switch("function"==typeof s.callback&&s.callback.apply(t,[]),s.type){case"fail":o(t,e);break;case"success":l(t,e)}},a.push(n)}),a},r=function(t){var e=[],a=$.Deferred();try{e=$(t.template)}catch(n){jse.core.debug(jse.core.lang.templateNotFound(t.template))}return e.length?a.resolve(e.html()):window.jse.lib.ajax({url:t.template,dataType:"html"}).done(function(e){if(t.storeTemplate){var n=$("<div />").attr("id",t.template).html(e);$("body").append(n)}a.resolve(e)}).fail(function(){a.reject()}),a},i=function(t,e,n,i,d){var c=$.Deferred(),u=c.promise(),m="",f={title:e||"",dialogClass:n||"",modal:!0,resizable:!1,buttons:i||[a.close],draggable:!1,closeOnEscape:!1,autoOpen:!1,template:d||"#modal_alert",storeTemplate:!1,closeX:!0,modalClose:!1},g=null,b=null;return t=t||{},t=$.extend({},f,t),t.buttons=s(t.buttons,c),r(t).done(function(e){m=$(Mustache.render(e,t)),t.validator&&m.find("form").attr("data-gx-widget","validator").find("input").attr({"data-validator-validate":t.validator.validate,"data-validator-regex":t.validator.regex||""}).addClass("validate"),m.dialog(t);try{g=m.dialog("instance")}catch(a){g=m.data("ui-dialog")}g.uiButtonSet.children().addClass("btn btn-default"),t.closeX===!1?g.uiDialogTitlebarClose.remove():g.uiDialogTitlebarClose.html("&times;").one("click",function(){o(g.element,c)}),t.modalClose&&$("body").find(".ui-widget-overlay").last().one("click",function(){o(g.element,c)}),b=g.element.find("form"),b.length&&b.on("submit",function(t){t.preventDefault()}),t.executeCode&&"function"==typeof t.executeCode&&t.executeCode.call($(g.element)),u.close=function(t){t?o(g.element,c):l(g.element,c)},m.dialog("open"),window.gx&&window.jse.widgets&&window.jse.widgets.init&&(window.jse.widgets.init(m),window.jse.controllers.init(m),window.jse.extensions.init(m))}).fail(function(){c.reject({error:"Template not found"})}),u};t.alert=function(t){e("jse.libs.modal.alert()");var n=$.extend({},{draggable:!0},t);return i(n,jse.core.lang.translate("hint","labels"),"",[a.ok])},t.confirm=function(t){e("jse.libs.modal.confirm()");var n=$.extend({},{draggable:!0},t);return i(n,jse.core.lang.translate("confirm","labels"),"confirm_dialog",[a.no,a.yes])},t.prompt=function(t){e("jse.libs.modal.prompt()");var n=$.extend({},{draggable:!0},t);return i(n,jse.core.lang.translate("prompt","labels"),"prompt_dialog",[a.abort,a.ok],"#modal_prompt")},t.success=function(t){e("jse.libs.modal.success()");var a=$.extend({},{draggable:!0},t);return i(a,jse.core.lang.translate("success","labels"),"success_dialog")},t.error=function(t){e("jse.libs.modal.error()");var a=$.extend({},{draggable:!0},t);return i(a,jse.core.lang.translate("error","labels"),"error_dialog")},t.warn=function(t){e("jse.libs.modal.warn()");var a=$.extend({},{draggable:!0},t);return i(a,jse.core.lang.translate("warning","labels"),"warn_dialog")},t.info=function(t){e("jse.libs.modal.info()");var a=$.extend({},{draggable:!0},t);return i(a,jse.core.lang.translate("info","labels"),"info_dialog")},t.message=function(t){$("body").append('<div class="modal-layer">'+t.content+"</div>"),t.modal=!0,t.dialogClass="gx-container",void 0===t.buttons&&(t.buttons=[{text:a.close.name,click:function(){$(this).dialog("close"),$(this).remove()}}]),$(".modal-layer:last").dialog(t)},t.showMessage=function(t,e){var a='<div class="modal fade" tabindex="-1" role="dialog">\n\t\t\t\t\t\t<div class="modal-dialog">\n\t\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close">\n\t\t\t\t\t\t\t\t\t\t<span aria-hidden="true">&times;</span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<h4 class="modal-title">'+t+'</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t                '+e+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>',n=$(a).appendTo("body");n.on("hidden.bs.modal",function(){return n.remove()}),n.modal("show")}}(jse.libs.modal);