"use strict";gx.compatibility.module("categories_table_controller",[gx.source+"/libs/button_dropdown"],function(t){var e=$(this),n={},i=($.extend(!0,{},n,t),{}),o=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?null:e[1]||0},a=o("pID"),c=o("cID"),r=$("tr[data-id="+a+"]"),p=$("tr[data-id="+c+"]");r.addClass("recentlyUpdated"),p.addClass("recentlyUpdated");var d=function(){var t=$('tr[data-id] input[type="checkbox"]:checked');$(".js-bottom-dropdown button").prop("disabled",!t.length)},s=function(t){var e={cPath:"",url:[l(),"categories.php","?action=multi_action"].join(""),pageToken:$('input[name="page_token"]:first').attr("value")};try{e.cPath=window.location.href.match(/cPath=(.*)/)[1]}catch(n){e.cPath=$("[data-cpath]:first").data().cpath}e.url+="&cPath="+e.cPath;var i=o("search");0!==i&&null!==i&&(e.url+="&search="+i);var a=$('<form name="multi_action_form" method="post" action='+e.url+"></form>");return a.append('<input type="hidden" name="cpath" value='+e.cPath+">"),a.append('<input type="hidden" name="page_token" value='+e.pageToken+">"),a.append('<input type="hidden" name='+t+' value="Action">'),a.appendTo("body"),a},u=function(){$(".gx-categories-table tr").not(".dataTableHeadingRow").each(function(){var t=$(this),e=t.data(),n=t.find(".js-button-dropdown");window.setTimeout(function(){t.find(".single-checkbox").on("click",function(t){t.stopPropagation(),d()})},500),e.isProduct?P(n,e):C(n,e),t.find(".fa-folder-open-o, .fa-pencil").parent().on("click",function(e){e.preventDefault();var n=t.find("td:eq(2) a[href]:first").prop("href");window.open(n,"_self")}),t.find(".fa-trash-o").parent().on("click",function(t){var e=n.find("span:contains("+jse.core.lang.translate("delete","buttons")+")");e.click()})})},l=function(){var t=window.location.origin,e=window.location.pathname,n=e.split("/");n.pop();var i=n.join("/");return t+i+"/"},f=function(t,e,n){var i=_[t],o=function(e){T(t,$(e.target),n)};jse.libs.button_dropdown.mapAction(e,t,i,o)},h=function(t,e,n){var i=b[t],o=function(e){y(t,$(e.target),n)};jse.libs.button_dropdown.mapAction(e,t,i,o)},_={edit:"buttons","delete":"buttons",BUTTON_MOVE:"admin_buttons",BUTTON_COPY:"admin_buttons",BUTTON_PROPERTIES:"admin_buttons",BUTTON_EDIT_CROSS_SELLING:"categories",GM_BUTTON_ADD_SPECIAL:"gm_general",BUTTON_EDIT_ATTRIBUTES:"admin_buttons"},b={edit:"buttons","delete":"buttons",BUTTON_MOVE:"admin_buttons",BUTTON_COPY:"admin_buttons",BUTTON_GOOGLE_CATEGORIES:"categories"},T=function(t,e,n){switch(t){case"edit":k(n);break;case"delete":m(e);break;case"BUTTON_MOVE":g(e);break;case"BUTTON_COPY":O(e);break;case"BUTTON_PROPERTIES":v(n);break;case"BUTTON_EDIT_CROSS_SELLING":x(n);break;case"GM_BUTTON_ADD_SPECIAL":w(n);break;case"BUTTON_EDIT_ATTRIBUTES":E(n);break;default:console.alert("Callback not found")}},k=function(t){var e=[l(),"categories.php","?pID="+t.id,"&cPath="+t.cpath,"&action=new_product"].join("");window.open(e,"_self")},m=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_delete");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},g=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_move");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},O=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_copy");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},v=function(t){var e=[l(),"properties_combis.php","?products_id="+t.id,"&cPath="+t.cpath,"&action=edit_category"].join("");window.open(e,"_self")},x=function(t){var e=[l(),"categories.php","?current_product_id="+t.id,"&cPath="+t.cpath,"&action=edit_crossselling"].join("");window.open(e,"_self")},w=function(t){var e=[l(),"specials.php","?pID="+t.id,"&action="+(void 0!==t.specialId?"edit":"new"),void 0!==t.specialId?"&sID="+t.specialId:""].join("");window.open(e,"_self")},E=function(t){var e=$('<form method="post" action='+(l()+"new_attributes.php")+"></form>");e.append('<input type="hidden" name="action" value="edit">'),e.append('<input type="hidden" name="current_product_id" value='+t.id+">"),e.append('<input type="hidden" name="cpath" value='+t.cpath+">"),e.appendTo("body"),e.submit()},y=function(t,e,n){switch(t){case"edit":I(n);break;case"delete":U(e);break;case"BUTTON_MOVE":B(e);break;case"BUTTON_COPY":N(e);break;case"BUTTON_GOOGLE_CATEGORIES":S(n);break;default:console.alert("Callback not found")}},I=function(t){var e=[l(),"categories.php","?cID="+t.id,"&cPath="+t.cpath,"&action=edit_category"].join("");window.open(e,"_self")},U=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_delete");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},B=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_move");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},N=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=s("multi_copy");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},S=function(t){var e=$(".lightbox_google_admin_categories");e.attr("href","google_admin_categories.html?categories_id="+t.id),e.click()},P=function(t,e){f("edit",t,e),f("delete",t,e),f("BUTTON_MOVE",t,e),f("BUTTON_COPY",t,e),jse.libs.button_dropdown.addSeparator(t,!0),f("BUTTON_PROPERTIES",t,e),f("BUTTON_EDIT_CROSS_SELLING",t,e),f("GM_BUTTON_ADD_SPECIAL",t,e),f("BUTTON_EDIT_ATTRIBUTES",t,e)},C=function(t,e){h("edit",t,e),h("delete",t,e),h("BUTTON_MOVE",t,e),h("BUTTON_COPY",t,e),jse.libs.button_dropdown.addSeparator(t,!0),h("BUTTON_GOOGLE_CATEGORIES",t,e)},D=function(t){$(t.target).prop("checked")===!0?($("input.checkbox").parent().addClass("checked"),$("input.checkbox").prop("checked",!0)):($("input.checkbox").parent().removeClass("checked"),$("input.checkbox").prop("checked",!1)),d()},R=function(){$(this).data("shortStockString",$(this).text()),$(this).text($(this).data("completeStockString"))},j=function(){$(this).text($(this).data("shortStockString"))};return i.init=function(t){var n=setInterval(function(){$(".js-button-dropdown").length>0&&(clearInterval(n),u(),d())},200);d(),$("#gm_check").on("click",D),e.on("mouseenter",".stock_warn",R).on("mouseleave",".stock_warn",j),t()},i});