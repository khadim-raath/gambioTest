"use strict";gx.compatibility.module("image_change",["image_resizer","xhr"],function(e){var a=$(this),i=jse.libs.image_resizer.resize,n=jse.libs.xhr,t={input:"input:file",form:"form",previewImage:"[data-image]",filenameLabel:"[data-filename-label]",filenameInput:"[data-filename-input]",showImage:"[data-show-image]",fileInputName:"[data-file-input-name]",originalImageName:"[data-original-image]"},l={},r=function(e){for(var l=a.find(t.previewImage),r=e.target.files[0],f=r.name,g=$('input[name="image_file['+f+']"]').length,o=1;0!==g;){var d=f.replace(/(\.)/,String(o)+".");g=$('input[name="image_file['+d+']"]').length,0===g&&(f=d),o++}n.get({url:"admin.php?do=MaxFileSize"}).done(function(e){var n=e.maxFileSize,g=r.size/Math.pow(1024,2);if(g>n){var o=jse.core.lang.translate("TXT_FILE_TOO_LARGE","categories");return void alert(o+n+" MB")}var d=new FileReader;d.onload=function(e){l.attr("src",e.target.result),i(l)},d.readAsDataURL(r),a.find(t.filenameLabel).text(f),a.find(t.filenameInput).val(f),a.find(t.showImage).val(f),a.find(t.originalImageName).val()||(a.find(t.originalImageName).val(f),a.find(t.showImage).val(f)),m()})},m=function(e){a.find(t.fileInputName).attr("name","image_file["+a.find(t.filenameInput).val()+"]")};return l.init=function(e){a.find(t.input).on("change",r),a.find(t.filenameInput).on("change",m),e()},l});