"use strict";gx.compatibility.module("orders_modal_layer",["xhr","fallback"],function(e){var t=$(this),a=($("#modal_layer_container"),$(".gx-orders-table tr:not(.dataTableHeadingRow) input")),r={detail_page:!1,comment:""},n=$.extend(!0,{},r,e),o={},i=function(e){var a=$("#delete_confirm_form");a.attr("action",a.attr("action")+"&oID="+t.data("order_id")),e.preventDefault();var r=jse.core.lang.translate("TEXT_INFO_HEADING_DELETE_ORDER","orders").replace("%s",t.data("order_id"));a.dialog({title:r,modal:!0,dialogClass:"gx-container",buttons:u(a),width:420})},c=function(e){var t=$("#delete_tracking_code_confirm_form"),a=jse.libs.fallback._data($(this),"orders_modal_layer");t.dialog({title:jse.core.lang.translate("TXT_PARCEL_TRACKING_DELETE_BUTTON","parcel_services").replace("%s",a.tracking_code),modal:!0,dialogClass:"gx-container",buttons:[{text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close")}},{text:jse.core.lang.translate("delete","buttons"),"class":"btn btn-primary",click:function(){$(this).dialog("close");var e="request_port.php?module=ParcelServices&action=delete_tracking_code";jse.libs.xhr.post({url:e,data:{tracking_code_id:a.tracking_code_id,order_id:a.order_id,page_token:a.page_token}}).done(function(e){$("#tracking_code_wrapper > .frame-content > table").html(e.html)})}}],width:420})},l=function(e){var r=$("#multi_delete_confirm_form");return e.preventDefault(),0!==a.filter(":checked").length&&(g(r),r.attr("action",r.attr("action")+"&oID="+t.data("order_id")),void r.dialog({title:jse.core.lang.translate("TEXT_INFO_HEADING_MULTI_DELETE_ORDER","orders").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(r),width:420}))},d=function(e){var r=$("#multi_cancel_confirm_form");if(e.preventDefault(),n.detail_page)r.append('<input type="hidden" name="gm_multi_status[]" value="'+n.order_id+'" />'),r.find(".selected_orders").text(n.order_id),r.find('textarea[name="gm_comments"]').html(n.comment);else{if(0===a.filter(":checked").length)return!1;g(r)}r.attr("action",r.attr("action")+"?oID="+t.data("order_id")),r.dialog({title:jse.core.lang.translate("TEXT_INFO_HEADING_MULTI_CANCEL_ORDER","orders").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(r),width:420})},s=function(e){var t=$("#update_orders_status_form");if(e.preventDefault(),n.detail_page)t.append('<input type="hidden" name="gm_multi_status[]" value="'+n.order_id+'" />'),t.find(".selected_orders").text(n.order_id),t.find('textarea[name="gm_comments"]').html(n.comment);else{if(0===a.filter(":checked").length)return!1;g(t)}t.dialog({title:jse.core.lang.translate("HEADING_GM_STATUS","orders"),modal:!0,dialogClass:"gx-container",buttons:u(t),width:580})},_=function(e){var a=$("#add_tracking_code_form");e.preventDefault(),a.dialog({title:jse.core.lang.translate("TXT_PARCEL_TRACKING_HEADING","parcel_services").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(a),width:420})},u=function(e){var t=[{text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close")}}];switch(n.action){case"delete":case"multi_delete":t.push({text:jse.core.lang.translate("delete","buttons"),"class":"btn btn-primary",click:function(){e.submit()}});break;case"add_tracking_code":t.push({text:jse.core.lang.translate("add","buttons"),"class":"btn btn-primary",click:function(e){m(e)}});break;case"update_orders_status":t.push({text:jse.core.lang.translate("execute","buttons"),"class":"btn btn-primary",click:function(t){e.submit()}});break;case"multi_cancel":t.push({text:jse.core.lang.translate("send","buttons"),"class":"btn btn-primary",click:function(t){e.submit()}})}return t},m=function(e){e.stopPropagation();var a=$("#parcel_service_tracking_code").val();return""!==a&&($.ajax({type:"POST",url:"request_port.php?module=ParcelServices&action=add_tracking_code",timeout:3e4,dataType:"json",context:this,data:{tracking_code:a,service_id:$("#parcel_services_dropdown option:selected").val(),order_id:t.data("order_id"),page_token:$(".page_token").val()},success:function(){document.location.reload()}}),!1)},g=function(e){var t=[];a.filter(":checked").each(function(){e.append('<input type="hidden" name="gm_multi_status[]" value="'+$(this).val()+'" />'),t.push($(this).val())}),e.find(".selected_orders").text(t.join(", "))};return o.init=function(e){switch(n.action){case"delete":t.on("click",i);break;case"multi_delete":t.on("click",l);break;case"add_tracking_code":t.on("click",_);break;case"update_orders_status":t.on("click",s);break;case"multi_cancel":t.on("click",d)}"tracking_code_wrapper"===n.container&&t.on("click",".btn-delete",c),e()},o});