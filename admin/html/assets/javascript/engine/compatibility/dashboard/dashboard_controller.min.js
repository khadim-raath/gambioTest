"use strict";gx.compatibility.module("dashboard_controller",["user_configuration_service","datatable"],function(a){var t=$(this),e=t.find(".latest-orders-table"),n={collapsed:!1},i=$.extend(!0,{},n,a),r=jse.libs.user_configuration_service,s=$(".js-interval-dropdown"),o=s.parents(".toolbar:first"),d=$(".statistic-chart"),c=$("#statistic-grid"),l=d.find("#dashboard-chart"),g=$(".statistic-chart-dropdown"),u=$(".statistic-tab-dropdown"),f=$(".ui-tabs"),p={},h=function(a){switch(a.orders_status){case"1":return"badge badge-warning";case"2":return"badge badge-primary";case"3":case"7":case"149":case"161":case"163":return"badge badge-success";case"0":case"6":case"99":case"162":case"171":return"badge badge-danger";default:return""}},b=function(a){$(this).parent("tr").find("td:eq(0) a").get(0).click()},v=function(){var a={userId:s.data("userId"),configurationKey:"statisticsInterval"},t=function(t){s.find('option[value="'+t+'"]').prop("selected",!0),o.animate({opacity:1},"slow"),s.on("change",function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=$(this).find("option:selected").val();c.trigger("get:data",n),l.is(":visible")&&l.trigger("get:data",n),e!==!1&&r.set({data:$.extend(a,{configurationValue:n})})}),$(document).on("JSENGINE_INIT_FINISHED",function(){s.trigger("change",[!1])})};o.animate({opacity:.1},"slow");var e=i.statisticsInterval||"one_week";t(e)},m=function(){function a(a){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];g.find('option[value="'+a+'"]').prop("selected",!0);var n=s.find("option:selected").val();g.animate({opacity:1},"slow"),l.trigger("get:data",n,a),t&&r.set({data:$.extend(e,{configurationValue:a})})}function t(){var t=setInterval(function(){if(l.is(":visible")){var e=i.statisticsChartItem||"sales";a(e,!1),clearInterval(t)}},100);g.off().on("change",function(){var t=$(this).find("option:selected").val();a(t)})}var e={userId:s.data("userId"),configurationKey:"statisticsChartItem"};$('a[href="#chart"]').off().on("click",t)},I=function(){function a(a){u.find('option[value="'+a+'"]').prop("selected",!0).trigger("change",[!1])}var t={userId:s.data("userId"),configurationKey:"statisticsTab"};u.on("change",function(a){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=$(this).find("option:selected").val();f.trigger("show:tab",n),e!==!1&&r.set({data:$.extend(t,{configurationValue:n})})});var e=""!==i.statisticsTab?i.statisticsTab:1;a(e)},_=function(){var a=$('<i class="fa fa-angle-double-up"></i>');i.collapsed&&(a=$('<i class="fa fa-angle-double-down"></i>'),$(".dashboard-chart").hide()),t.find(".dashboard-toggler").append(a),a.on("click",y)},y=function(a,e){var n={userId:s.data("userId"),configurationKey:"dashboard_chart_collapse",configurationValue:!i.collapsed};i.collapsed=!i.collapsed,r.set({data:n}),i.collapsed?$(".dashboard-chart").slideUp():($(".statistic-tab-dropdown").trigger("change"),$(".dashboard-chart").slideDown()),t.find(".dashboard-toggler i").toggleClass("fa-angle-double-down"),t.find(".dashboard-toggler i").toggleClass("fa-angle-double-up")};return p.init=function(a){v(),m(),I(),_(),jse.libs.datatable.create(e,{processing:!0,dom:"t",ordering:!1,ajax:jse.core.config.get("appUrl")+"/admin/admin.php?do=Dashboard/GetLatestOrders",language:jse.libs.datatable.getTranslations(jse.core.config.get("languageCode")),order:[[3,"desc"]],columns:[{data:"orders_id",className:"text-right",render:function(a,t,e,n){return'<a href="orders.php?page=1&oID='+a+'&action=edit">'+a+"</a>"}},{data:"customers_name"},{data:"text",className:"text-right"},{data:"date_purchased",render:function(a,t,e,n){var i=Date.parse(a);return i.toString("dd.MM.yyyy HH:mm")}},{data:"payment_method"},{data:"orders_status_name",render:function(a,t,e,n){var i=h(e);return'<span class="badge '+i+'">'+a+"</span>"}}]}),e.on("init.dt",function(){e.DataTable().data().length>0&&e.on("click","tbody tr td",b),t.find('tr:not(":eq(0)")').addClass("cursor-pointer")}),a()},p});