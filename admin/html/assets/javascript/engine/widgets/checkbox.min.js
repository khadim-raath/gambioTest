"use strict";gx.widgets.module("checkbox",["fallback"],function(e){var s=$(this),a={filter:"",on_url:"",off_url:"",on_label:"",off_label:"",on_text:"",off_text:"","class":"",checked:!1},t=!1,c=$.extend(!0,{},a,e),i={},n=function(e){if($(this).hasClass("disabled"))return!1;var s=$(this),a=s.find("input:checkbox"),t=s.find("input:radio").first(),i=s.find("input:radio").last(),n=s.find("select").first();s.parent().data("checkbox");s.toggleClass("checked"),s.find(".state-description").show().fadeOut("slow"),a.prop("checked",s.hasClass("checked")).trigger("checkbox:change"),t.prop("checked",s.hasClass("checked")),i.prop("checked",!s.hasClass("checked")),n.find("option").removeAttr("selected");var o=s.hasClass("checked")?1:0;if(n.find('option[value="'+o+'"]').attr("selected",!0),""!==c.on_url&&""!==c.off_url){if(e.preventDefault(),e.stopPropagation(),c.checked)return window.location.href=c.off_url,c.checked=!1,!1;window.location.href=c.on_url,c.checked=!0}},o=function(){return!$(this).hasClass("disabled")&&(t=!0,void $(this).find("input:checkbox").focus())},l=function(){return!$(this).hasClass("disabled")&&($(this).toggleClass("checked"),$(this).find("input:checkbox").focus(),$(this).find("input:checkbox").trigger("click"),void(t=!1))},d=function(e){var a=e||s;a.find("input:checkbox").filter(c.filter||"*").each(function(){var e=$(this),s=jse.libs.fallback._data(e,"checkbox"),a=s.className||"",i=e.prop("title"),n=e.prop("checked")?"checked":"",o=e.prop("disabled")?"disabled":"";if("undefined"!=typeof e.data("single_checkbox"))e.css({position:"absolute",left:"-100000px"}).wrap('<span class="single-checkbox '+n+" "+o+'" title="'+i+'"></span>').parent().append('<i class="fa fa-check"></i>'),e.on("focus",function(){$(".single_checkbox").removeClass("focused"),$(this).parent().addClass("focused")}),e.on("blur",function(){$(this).parent().removeClass("focused")}),e.on("change",function(){t===!1&&$(this).parent().toggleClass("checked")});else{var l=e.attr("data-checkbox-on_text")?e.attr("data-checkbox-on_text"):'<span class="fa fa-check"></span>',d=e.attr("data-checkbox-on_text")?e.attr("data-checkbox-off_text"):'<span class="fa fa-times"></span>';e.wrap('<div class="switcher '+n+" "+o+'" title="'+i+'"></div>').parent().data("checkbox",s).addClass(a).append('<div class="switcher-toggler"></div><div class="switcher-inner"><div class="switcher-state-on">'+l+'</div><div class="switcher-state-off">'+d+'</div></div><div class="switcher-text-on">'+c.on_text+'</div><div class="switcher-text-off">'+c.off_text+"</div>")}})},f=function(){if(2===s.find("input:radio").filter(c.filter||"*").length){var e=s.find("input:radio").filter(c.filter||"*").first(),a=e.prop("title"),t=s.find("input:radio").filter(c.filter||"*").last(),i=t.prop("title"),n=""!==c.on_label?' data-checkbox-label="'+c.on_label+'"':"",o=""!==c.off_label?' data-checkbox-label="'+c.off_label+'"':"",l=c,d=e.prop("checked")?"checked":"",f=e.prop("disabled")?"disabled":"",r=$('<div class="switcher '+d+" "+f+'"></div>');e.after(r),e.appendTo(r),t.appendTo(r),r.data("checkbox",l).addClass(c["class"]).append('<div class="switcher-toggler"></div><div class="switcher-inner"><div class="switcher-state-on" title="'+a+'"'+n+'><span class="fa fa-check"></span></div><div class="switcher-state-off" title="'+i+'"'+o+'><span class="fa fa-times"></span></div><div class="switcher-text-on">'+c.on_text+'</div><div class="switcher-text-off">'+c.off_text+"</div></div>"),e.on("change",function(){$(this).parent().toggleClass("checked")}),t.on("change",function(){$(this).parent().toggleClass("checked")})}},r=function(){if(""!==c.on_url&&""!==c.off_url){var e=jse.libs.fallback._data(s,"checkbox"),a=""!==c.on_label?' data-checkbox-label="'+c.on_label+'"':"",t=""!==c.off_label?' data-checkbox-label="'+c.off_label+'"':"",i=c.checked?"checked":"";s.data("checkbox",e).addClass("switcher").addClass(i).addClass(c["class"]).append('<div class="switcher-toggler"></div><div class="switcher-inner"><div class="switcher-state-on" title="'+c.off_url+'"'+a+'><span class="fa fa-check"></span></div><div class="switcher-state-off" title="'+c.on_url+'"'+t+'><span class="fa fa-times"></span></div></div>').on("click",n)}},h=function(){s.on("click",".switcher",n),s.off("mousedown",".single-checkbox"),s.on("mousedown",".single-checkbox",o),s.off("mouseup",".single-checkbox"),s.on("mouseup",".single-checkbox",l),s.on("mousedown","label",function(){t=!0}),s.on("mouseup","label",function(){t=!1}),s.on("FORM_UPDATE",function(e){var s=$(e.target);s.find("input:checkbox").each(function(){var e=$(this),s=e.closest(".switcher");s.length&&(s.find("div").remove(),e.unwrap())}),d(s)})},p=function(){s.find("[data-convert-checkbox]").each(function(e,s){var a=$(s).find('option[value="1"]'),t=($(s).find('option[value="0"]'),a.is(":selected")?"checked":""),i=$(s).is(":disabled")?"disabled":"",n=$('<div class="switcher '+t+" "+i+'"></div>');n.addClass($(s).data("newClass")).data("checkbox",c).append('<div class="switcher-toggler"></div><div class="switcher-inner"><div class="switcher-state-on"><span class="fa fa-check"></span></div><div class="switcher-state-off"><span class="fa fa-times"></span></div></div>'),$(s).after(n).appendTo(n).hide()})};return i.init=function(e){c.on_url=c.on_url.replace('"',""),c.off_url=c.off_url.replace('"',""),d(),f(),p(),r(),h(),e()},i});