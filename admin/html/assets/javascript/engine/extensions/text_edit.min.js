"use strict";gx.extensions.module("text_edit",["xhr","modal","fallback"],function(t){var e=$(this),a={},i=$.extend(!0,{},a,t),n={},s=null,l=function(t,e){var a=t.find("textarea"),i=t.find("ul.actions li"),n=a.data("data");a.prop("disabled",!0),e&&a.val(n),i.hide().filter(".edit").show(),a.data("texteditEdited")?i.filter(".reset").show():i.filter(".reset").hide()},o=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),i=e.find("ul.actions li"),n=a.val();a.data("data",n).val("").prop("disabled",!1).focus().val(n),t.hide().siblings().show(),a.data("texteditEdited")?i.filter(".reset").show():i.filter(".reset").hide()},r=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),i=a.val(),n=a.data("data");i!==n?jse.libs.modal.confirm({content:jse.core.lang.translate("discard_changes_prompt","messages"),title:jse.core.lang.translate("abort","buttons"),position:{my:"center",at:"center",of:e}}).done(function(){l(e,!0)}):l(e)},d=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),n=a.val(),s=a.data("data"),o=jse.libs.fallback._data(a,"text_edit");o.value=n,t.hasClass("pending")||(n!==s?(t.addClass("pending"),jse.libs.xhr.ajax({url:i.url,data:o}).done(function(t){a.data("texteditEdited",t.edited),e.find(".searchSection").attr("title",t.source),l(e)}).fail(function(){jse.libs.modal.error({content:"Error",title:"Error",position:{my:"center",at:"center",of:e}})}).always(function(){t.removeClass("pending")})):l(e))},c=function(){var e=$(this),a=e.closest(".dataTableRow"),n=a.find("textarea");t=jse.libs.fallback._data(e,"text_edit"),e.hasClass("pending")||(e.addClass("pending"),jse.libs.xhr.ajax({url:i.url,data:t}).done(function(t){t.success&&(a.find(".searchSection").attr("title",t.source),n.val(t.value),n.data("texteditEdited",!1),l(a),e.hide())}).fail(function(){jse.libs.modal.error({content:"Error",title:"Error",position:{my:"center",at:"center",of:a}})}).always(function(){e.removeClass("pending")}))},f=function(){var t=($(this),jse.libs.fallback._data($(this),"text_edit"));s.trigger("submitform",[t]),window.scrollTo(0,0)};return n.init=function(t){s=$("#"+i.filter),e.on("click",".edit",o).on("click",".save",d).on("click",".abort",r).on("click",".reset",c),s.length&&e.on("click",".searchPhrase, .searchSection",f),$("#needle").focus(),t()},n});