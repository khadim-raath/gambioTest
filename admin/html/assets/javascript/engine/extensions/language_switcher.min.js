"use strict";gx.extensions.module("language_switcher",["form","fallback"],function(t){var e=$(this),n={position:1,initLang:js_options.global.language_id},a=$.extend(!0,{},n,t),i={},r=[],o=null,c=[],l=function(t,n){var i={},o=jse.libs.fallback.getData(e);return $.each(r,function(e,r){var c=r.match(/\[([^\]]+)\]/gi),l=r.split("[")[0],s=l,f=l,u=!1;c&&($.each(c,function(e,i){a.position!==e?(f+=i,s+=i):(n?f+="["+t+"]":s+="["+t+"]",u=!0)}),u&&void 0!==o[s]&&(i[f]=o[s]))}),i},s=function(t){var n=t.attr("href").slice(1);e.find("textarea").each(function(){var t=$(this),e=t.attr("name"),n=window.CKEDITOR?CKEDITOR.instances[e]:null;n&&t.val(n.getData())}),jse.libs.form.prefillForm(e,l(n,!0),!1)},f=function(t){var n=t.attr("href").slice(1);jse.libs.form.prefillForm(e,l(n,!1),!1),e.find("textarea").not("[data-language_switcher-ignore]").each(function(){var t=$(this),e=t.attr("name"),n=t.text(),a=window.CKEDITOR?CKEDITOR.instances[e]:null;a&&a.setData(n)})},u=function(){window.CKEDITOR&&e.find("textarea").each(function(){var t=$(this).attr("name");CKEDITOR.instances[t]&&$.inArray(t,c)===-1&&(c.push(t),CKEDITOR.instances[t].on("blur",function(){s(o.filter(".active"))}))})},g=function(t){t.preventDefault();var e=$(this);if(!e.hasClass("active")){var n=o.filter(".active");o.removeClass("active"),e.addClass("active"),n.length&&s(n),f(e)}},v=function(t){t.preventDefault();var e=o.filter(".active");f(e)},h=function(t,e){if(e&&e.deferred){var n=o.filter(".active").first().attr("href").slice(1);e.deferred.resolve(n)}};return i.init=function(t){o=e.find(".buttonbar a");var n=function(){r=[];var t=e.find("input:not(:button):not(:submit), select, textarea").not("[data-language_switcher-ignore]");t.each(function(){var t=$(this),e=jse.libs.form.getFieldType(t),n=$.inArray(e,["text","textarea"])>-1?"blur":"change",a=t.attr("name");r.push(a),t.on(n,function(){s(o.filter(".active"))})}),u()};n(),o.on("click",g).filter('[href="#'+a.initLang+'"]').trigger("click"),$("body").on("JSENGINE_INIT_FINISHED",function(){u()}),e.on("layerClose",function(){s(o.filter(".active"))}).on("language_switcher.update",n).on("language_switcher.updateField",v).on("language_switcher.getLang",h),t()},i});