"use strict";gx.controllers.module("emails_modal",[gx.source+"/libs/emails","modal","datatable","normalize"],function(e){var a=$(this),t=($("#emails-table"),$("#emails-toolbar"),a.find("#contacts-table")),n=a.find("#attachments-table"),s={contactsTableActions:function(e,a,t,n){return'<div class="row-actions"><span class="delete-contact action-item" title="'+jse.core.lang.translate("delete","buttons")+'"><i class="fa fa-trash-o"></i></span></div>'},attachmentsTableActions:function(e,a,t,n){var s,l;return e.file_exists?(s="",l=jse.core.lang.translate("download","buttons")):(s='disabled="disabled"',l=jse.core.lang.translate("message_download_attachment_error","emails")),'<div class="row-actions"><span class="delete-attachment action-item" title="'+jse.core.lang.translate("delete","buttons")+'"><i class="fa fa-trash-o"></i></span><span class="download-attachment action-item" title="'+l+'" '+s+'><i class="fa fa-download"></i></span></div>'},convertUpperCase:function(e,a,t,n){return e.toUpperCase()},lengthMenu:[[5,10],[5,10]]},l=$.extend(!0,{},s,e),o={},i=function(e){if(a.find(".tab-content.bcc-cc").trigger("validator.validate"),!(a.find(".tab-content.bcc-cc .error").length>0)){var t={name:jse.libs.normalize.escapeHtml(a.find("#contact-name").val()),email:jse.libs.normalize.escapeHtml(a.find("#contact-email").val()),type:jse.libs.normalize.escapeHtml(a.find("#contact-type").val())};a.find("#contacts-table").DataTable().row.add(t).draw(),a.find("#contact-name, #contact-email, #contact-type").removeClass("valid error"),a.find("#contact-name, #contact-email").val(""),a.find("#contact-type option:first").prop("selected",!0),jse.libs.emails.updateTabCounters(a)}},c=function(e){var t=$(this).parents("tr");a.find("#contacts-table").DataTable().row(t).remove().draw(),jse.libs.emails.updateTabCounters(a)},r=function(e,t){return t.exception?void jse.libs.modal.message({title:jse.core.lang.translate("error","messages"),content:jse.core.lang.translate("message_upload_attachment_error","emails")+t.message}):(a.find("#attachments-table").DataTable().row.add({path:jse.libs.normalize.escapeHtml(t.path),file_exists:!0}).draw(),a.find("#upload-attachment").val(""),void jse.libs.emails.updateTabCounters(a))},d=function(e){var t=$(this).parents("tr").get(0),s=jse.core.config.get("appUrl")+"/admin/admin.php?do=Emails/DeleteAttachment",l={pageToken:jse.core.config.get("pageToken"),attachments:[n.DataTable().row(t).data().path]};$.post(s,l,function(e){return jse.core.debug.info("AJAX File Remove Response",e),e.exception?void jse.libs.modal.message({title:jse.core.lang.translate("error","messages"),content:jse.core.lang.translate("message_remove_attachment_error")+e.message}):(a.find("#attachments-table").DataTable().row(t).remove().draw(),void jse.libs.emails.updateTabCounters(a))},"json")},m=function(e){if("disabled"!==$(this).attr("disabled")){var a=$(this).parents("tr").get(0),t=n.DataTable().row(a).data().path,s=jse.core.config.get("appUrl")+"/admin/admin.php?do=Emails/DownloadAttachment&path="+t;window.open(s,"_blank")}},b=function(e){a.find(".tab-content.details .error").length>0?a.find(".tab-headline.details").css("color","red"):a.find(".tab-headline.details").css("color","")};return o.init=function(e){jse.libs.datatable.create(t,{autoWidth:!1,order:[[0,"asc"]],language:"de"===jse.core.config.get("languageCode")?jse.libs.datatable.getGermanTranslation():null,lengthMenu:l.lengthMenu,pageLength:5,columns:[{data:"email",width:"45%"},{data:"name",width:"35%"},{data:"type",render:l.convertUpperCase,width:"10%"},{data:null,orderable:!1,defaultContent:"",render:l.contactsTableActions,width:"10%",className:"dt-head-center dt-body-center"}]}),jse.libs.datatable.create(n,{autoWidth:!1,order:[[0,"asc"]],language:"de"===jse.core.config.get("languageCode")?jse.libs.datatable.getGermanTranslation():null,lengthMenu:l.lengthMenu,pageLength:5,columns:[{data:"path",width:"90%"},{data:null,orderable:!1,defaultContent:"",render:l.attachmentsTableActions,width:"10%",className:"dt-head-center dt-body-center"}]}),jse.libs.emails.updateTabCounters(a),a.on("click","#add-contact",i).on("click",".delete-contact",c).on("upload","#upload-attachment",r).on("click",".delete-attachment",d).on("click",".download-attachment",m).on("validator.validate",b),e()},o});