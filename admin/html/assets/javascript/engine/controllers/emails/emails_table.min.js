"use strict";gx.controllers.module("emails_table",[gx.source+"/libs/emails","modal","datatable","normalize"],function(e){var a=$(this),t=($("#emails-toolbar"),$("#emails-modal")),s={emailsTableActions:function(){return'<div class="row-actions"><span class="send-email action-item" title="'+jse.core.lang.translate("send","buttons")+'"><i class="fa fa-envelope-o"></i></span><span class="forward-email action-item" title="'+jse.core.lang.translate("forward","buttons")+'"><i class="fa fa-share"></i></span><span class="delete-email action-item" title="'+jse.core.lang.translate("delete","buttons")+'"><i class="fa fa-trash-o"></i></span><span class="preview-email action-item" title="'+jse.core.lang.translate("preview","buttons")+'"><i class="fa fa-eye"></i></span></div>'},convertPendingToString:function(e,a,t,s){return e===!0?jse.core.lang.translate("email_pending","emails"):jse.core.lang.translate("email_sent","emails")}},n=$.extend(!0,{},s,e),l={},i=function(e){$(this).prop("checked")?(a.find("tbody .single-checkbox").addClass("checked"),a.find("tbody input:checkbox").prop("checked",!0)):(a.find("tbody .single-checkbox").removeClass("checked"),a.find("tbody input:checkbox").prop("checked",!1))},o=function(e){var t=$(this).parents("tr");jse.libs.modal.message({title:jse.core.lang.translate("send","buttons"),content:jse.core.lang.translate("prompt_send_email","emails"),buttons:[{text:jse.core.lang.translate("no","lightbox_buttons"),click:function(){$(this).dialog("close")}},{text:jse.core.lang.translate("yes","lightbox_buttons"),click:function(){var e=t.data();jse.libs.emails.sendCollection([e]).done(function(e){a.DataTable().ajax.reload(),jse.libs.emails.getAttachmentsSize($("#attachments-size"))}).fail(function(e){var a=jse.core.lang.translate("error","messages");jse.libs.modal.message({title:a,content:e.message})}),$(this).dialog("close")}}]})},r=function(e){var s=$(this).parents("tr").data();jse.libs.emails.resetModal(t),jse.libs.emails.loadEmailOnModal(s,t),t.find("#email-id").val(""),t.find("#sender-email, #sender-name").val(""),t.find("#reply-to-email, #reply-to-name").val(""),t.find("#recipient-email, #recipient-name").val(""),t.find("#contacts-table").DataTable().clear().draw(),t.dialog({title:jse.core.lang.translate("forward","buttons"),width:1e3,height:740,modal:!0,dialogClass:"gx-container",closeOnEscape:!1,buttons:jse.libs.emails.getDefaultModalButtons(t,a),open:jse.libs.emails.colorizeButtonsForEditMode})},c=function(e){var t=$(this).parents("tr"),s=t.data();jse.libs.modal.message({title:jse.core.lang.translate("delete","buttons"),content:jse.core.lang.translate("prompt_delete_email","emails"),buttons:[{text:jse.core.lang.translate("no","lightbox_buttons"),click:function(){$(this).dialog("close")}},{text:jse.core.lang.translate("yes","lightbox_buttons"),click:function(){jse.libs.emails.deleteCollection([s]).done(function(e){a.DataTable().ajax.reload(),jse.libs.emails.getAttachmentsSize($("#attachments-size"))}).fail(function(e){var a=jse.core.lang.translate("error","messages");jse.libs.modal.message({title:a,content:e.message})}),$(this).dialog("close")}}]})},d=function(e){var s=$(this).parents("tr").data();jse.libs.emails.resetModal(t),jse.libs.emails.loadEmailOnModal(s,t),t.dialog({title:jse.core.lang.translate("preview","buttons"),width:1e3,height:740,modal:!1,dialogClass:"gx-container",closeOnEscape:!1,buttons:jse.libs.emails.getPreviewModalButtons(t,a),open:jse.libs.emails.colorizeButtonsForPreviewMode})};return l.init=function(e){jse.libs.datatable.create(a,{processing:!1,serverSide:!0,dom:"rtip",autoWidth:!1,language:"de"===jse.core.config.get("languageCode")?jse.libs.datatable.getGermanTranslation():null,ajax:{url:jse.core.config.get("appUrl")+"/admin/admin.php?do=Emails/DataTable",type:"POST"},order:[[2,"desc"]],pageLength:20,columns:[{data:null,orderable:!1,defaultContent:'<input type="checkbox" data-single_checkbox />',width:"2%",className:"dt-head-center dt-body-center"},{data:"row_count",orderable:!1,width:"3%",className:"dt-head-center dt-body-center"},{data:"creation_date",width:"12%"},{data:"sent_date",width:"12%"},{data:"sender",width:"12%"},{data:"recipient",width:"12%"},{data:"subject",width:"27%"},{data:"is_pending",width:"8%",render:n.convertPendingToString},{data:null,orderable:!1,defaultContent:"",render:n.emailsTableActions,width:"12%"}]}),jse.libs.datatable.error(a,function(e,a,t,s){jse.libs.modal.message({title:"DataTables "+jse.core.lang.translate("error","messages"),content:s})}),jse.libs.datatable.ajaxComplete(a,function(e,t,s){s.exception===!0&&(jse.core.debug.error("DataTables Processing Error",a.get(0),s),jse.libs.modal.message({title:"AJAX "+jse.core.lang.translate("error","messages"),content:s.message}))}),a.on("init.dt",function(e,a,t){$(".paginator").appendTo($("#emails-table_wrapper")),$("#emails-table_info").appendTo($(".paginator .datatable-components")).css("clear","none"),$("#emails-table_paginate").appendTo($(".paginator .datatable-components")).css("clear","none")}),a.on("draw.dt",function(){a.find("tbody").attr("data-gx-widget","checkbox"),gx.widgets.init(a)});var t;a.on("preXhr.dt",function(e,s,n){t=jse.libs.loading_spinner.show(a)}),a.on("xhr.dt",function(e,a,s){t&&jse.libs.loading_spinner.hide(t)}),a.on("click","#select-all-rows",i).on("click",".send-email",o).on("click",".forward-email",r).on("click",".delete-email",c).on("click",".preview-email",d),e()},l});