"use strict";gx.controllers.module("menu",["user_configuration_service"],function(t){function e(){p.hasClass("expand-all")||(v=$(this).children("ul"),0!==v.length&&(v.offset=v.offset().top+v.height(),v.offset>window.innerHeight&&v.css("margin-top",-1*(v.offset-window.innerHeight+$("#main-header").outerHeight()+$("#main-footer .info").outerHeight())+"px").addClass("stay-within-viewport")))}function n(){p.hasClass("expand-all")||v.css("margin-top","").removeClass("stay-within-viewport")}function i(t){t.draggable({helper:"clone",start:function(t,e){w=!0,e.helper.addClass("currentlyDragged"),a(this)},stop:function(t){w=!1,$(g).remove()}})}function a(t){var e="",n="";0===$(t).parents("li").find(".fa-heart").length?(e='\n\t\t\t\t<div id="fav-dropzone-box" class="fav-add">\n\t\t\t\t\t<i class="fa fa-heart"></i>\n\t\t\t\t</div>\n\t\t\t',n="save"):(e='\n\t\t\t\t<div id="fav-dropzone-box" class="fav-delete">\n\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t</div>\n\t\t\t',n="delete"),l(e,t),$(g).droppable(d(n,t))}function o(t,e){$.ajax({url:"admin.php?do=AdminFavoritesAjax/AddMenuItem&link_key="+t,error:function(e){console.error("Could not save the menu item with the link key: "+t)},success:function(){if(!s(t)){var n=$(e).clone().addClass("fav-drag-item"),a=$("<li/>").append(n);h.append(a),i(a.find(".fav-drag-item"))}}})}function r(t,e){$.ajax({url:"admin.php?do=AdminFavoritesAjax/RemoveMenuItem&link_key="+t,error:function(e){console.error("Could not remove the menu item with the link key: "+t)},success:function(){$(e).parent("li").remove()}})}function s(t){return 0!==h.find("#"+t).length}function d(t,e){var n={accept:".fav-drag-item",tolerance:"pointer",over:function(){$(g).css("opacity","1.0")},out:function(){$(g).css("opacity","0.9")},drop:function(n,i){var a=$(i.draggable).attr("id");"save"===t?o(a,e):"delete"===t&&r(a,e)}};return n}function l(t,e){var n=$(t);$(e).parent("li").prepend(n);var i=n.outerHeight();n.css({top:$(e).position().top-i/2})}function c(){var t=$.deparam(window.location.search.slice(1));p.find("li:gt(1) a").each(function(e,n){var i=$.deparam($(n).attr("href").replace(/.*(\?)/,"$1").slice(1));if(i["do"]===t["do"])return $(n).parents("li:lt(2)").addClass("active"),!1})}var f=$(this),u={},p=f.children("ul"),v=null,h=f.find("ul li").first().find("ul"),m=f.find(".fav-drag-item"),g="#fav-dropzone-box",w=!1;return u.init=function(t){p.children("li").on("mouseenter",e).on("mouseleave",n),i(m),c(),t()},u});