"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();gx.controllers.module("search",["user_configuration_service"],function(t){var e=this,i={bindings:{input:$(this).find(".search-input")}},n=function(){function e(t,i,n,r,s){_classCallCheck(this,e),this.$searchBar=i,this.$input=this.$searchBar.find(".search-input"),this.$list=this.$searchBar.find(".search-list"),this.$listItems=this.$list.find(".search-list-item"),this.$button=$(".actions .search"),this.listItemSearchTermPlaceholderSelector=".search-term-placeholder",this.DEFAULT_ENTITY="orders",this.binding=r,this.userCfgService=n,this.entity=null,s()}return _createClass(e,[{key:"initialize",value:function(){var e=this;return this.$input.on("click",function(t){return e._onInputClick(t)}).on("keyup",function(t){return e._onInputKeyUp(t)}),$(window).on("click",function(t){return e._onOutsideClick(t)}).on("blur",function(t){return e._onWindowBlur(t)}),this.$listItems.on("click",function(t){return e._onListClick(t)}),this.$button.on("click",function(t){return e._onButtonClick(t)}),this._setEntity(t.recentSearchArea||this.DEFAULT_ENTITY),this}},{key:"_setUserCfgValue",value:function(t){var e=$.extend(!0,{},this.userCfgData,{configurationValue:t});return this.userCfgService.set({data:e}),this}},{key:"_setEntity",value:function(t){return this.entity=t,this.$list.find('li[data-search-entity="'+t+'"]').addClass("active"),this}},{key:"_onInputClick",value:function(t){return this._togglePlaceholder(!0)._fillTermInListItems()._toggleDropdown(!0),this}},{key:"_onInputKeyUp",value:function(t){var e=27,i=38,n=40,r=13;switch(t.which){case e:this._toggleDropdown(!1)._togglePlaceholder(!1).$input.trigger("blur");break;case r:this._performSearch();break;case i:case n:var s=t.which===i?"up":"down";this._cycleDropdownSelection(s);break;default:this._fillTermInListItems()}return this}},{key:"_onOutsideClick",value:function(t){var e=t.target,i=!this.$searchBar.has(e).length,n=!this.$button.has(e).length;return i&&n&&this._toggleDropdown(!1)._togglePlaceholder(!1).$input.trigger("blur"),this}},{key:"_onListClick",value:function(t){var e=$(t.currentTarget).data("searchEntity");return this._togglePlaceholder(!0,e)._setEntity(e)._performSearch(),this}},{key:"_onButtonClick",value:function(t){return this.$input.trigger("click").trigger("focus"),this}},{key:"_onWindowBlur",value:function(t){this._toggleDropdown(!1)._togglePlaceholder(!1).$input.trigger("blur")}},{key:"_getTranslationForEntity",value:function(t){var e="admin_labels",i="admin_search_"+t;return jse.core.lang.translate(i,e)}},{key:"_fillTermInListItems",value:function(){var t=this;return this.$list.find(this.listItemSearchTermPlaceholderSelector).each(function(e,i){return $(i).text(t.binding.get())}),this}},{key:"_toggleDropdown",value:function(t){var e="active";return t?this.$list.addClass(e):this.$list.removeClass(e),this}},{key:"_togglePlaceholder",value:function(t,e){if(t){var i=i||this._getTranslationForEntity(this.entity);this.$input.prop("placeholder",i)}else this.$input.prop("placeholder","");return this}},{key:"_cycleDropdownSelection",value:function(t){var e=this.$listItems.filter(".active"),i=this.$listItems.first(),n=this.$listItems.last(),r="up"===t?e.prev():e.next();r.length||(r="up"===t?n:i);var s=r.data("searchEntity");return e.removeClass("active"),this._setEntity(s)._togglePlaceholder(!0,s),this}},{key:"_performSearch",value:function(){var t="_self",e={customers:"customers.php?search=",categories:"categories.php?search=",orders:"admin.php?"+$.param({"do":"OrdersOverview",filter:{number:""}})},i=e[this.entity]+encodeURIComponent(this.binding.get());this._setUserCfgValue(this.entity),window.open(i,t)}}]),e}();return i.init=function(r){var s=t.customerId,a=$(e),l=jse.libs.user_configuration_service,o=i.bindings.input,c=new n(s,a,l,o,r);c.initialize()},i});