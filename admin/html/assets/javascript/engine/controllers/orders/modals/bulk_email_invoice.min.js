"use strict";function _defineProperty(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}gx.controllers.module("bulk_email_invoice",["modal","loading_spinner"],function(e){function n(e){e?_=jse.libs.loading_spinner.show(o.find(u),o.css("z-index")):jse.libs.loading_spinner.hide(_)}function i(e,n){var i=d.bindings.subject.get(),a=function(a){var t=f[a],r="string"!=typeof f[a],o=r?n[t[s]]:e[t];i=i.replace(a,o)};return Object.keys(f).forEach(a),i}function a(){var e=jse.core.lang.translate("BULK_MAIL_SUCCESS","gm_send_order");jse.libs.info_box.service.addSuccessMessage(e),$(".orders .table-main").DataTable().ajax.reload(),$(".orders .table-main").orders_overview_filter("reload"),n(!1),o.modal("hide")}function t(){var e=jse.core.lang.translate("error","messages"),i=jse.core.lang.translate("BULK_MAIL_UNSUCCESS","gm_send_order");jse.libs.modal.message({title:e,content:i}),n(!1),o.modal("hide")}function r(){var e=[],r=o.find(c);return r.length?(n(!0),r.each(function(n,a){var t=$(a).data("invoice"),r=$(a).find(l).val(),o=new Promise(function(e,n){var i={url:g,method:"GET",data:{"do":"OrdersModalsAjax/GetEmailInvoiceSubjectData",id:t.id,date:t.purchaseDate.date,pageToken:jse.core.config.get("pageToken")},dataType:"json"},a=$.ajax(i);a.done(function(n){return e(n)}),a.fail(function(){return n()})}),d=new Promise(function(e,n){o.then(function(a){var o={oID:t.id,type:"invoice",mail:"1",gm_quick_mail:"1"},d=m+"?"+$.param(o),s={gm_mail:r,gm_subject:i(t,a)},c=$.ajax({method:"POST",url:d,data:s});c.done(function(n){return e(n)}),c.fail(function(){return n()})})["catch"](n)});e.push(d)}),void Promise.all(e).then(a)["catch"](t)):void o.modal("hide")}var o=$(this),d={bindings:{subject:o.find(".subject")}},s="requestKey",c=".email-list-item",l=".email-input",u=".modal-content",f={"{INVOICE_NUM}":_defineProperty({},s,"invoiceId"),"{INVOICE_DATE}":_defineProperty({},s,"date"),"{ORDER_ID}":"id"},m=jse.core.config.get("appUrl")+"/admin/gm_pdf_order.php",g=jse.core.config.get("appUrl")+"/admin/admin.php",_=null;return d.init=function(e){o.on("click",".btn.send",r),e()},d});