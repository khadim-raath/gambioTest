"use strict";gx.controllers.module("events",["loading_spinner"],function(e){function n(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n!==!1&&x.find("tbody input:checkbox").single_checkbox("checked",$(this).prop("checked"))}function o(e){$(e.target).is("td")&&$(this).find("input:checkbox").prop("checked",!$(this).find("input:checkbox").prop("checked")).trigger("change")}function a(){x.find("input:checkbox:checked").length>0?x.parents(".orders").find(".bulk-action > button").removeClass("disabled"):x.parents(".orders").find(".bulk-action > button").addClass("disabled")}function t(e){e.preventDefault();var n=r($(this));$(".cancel.modal .selected-orders").text(n.join(", ")),$(".cancel.modal").modal("show")}function i(e){e.preventDefault();var n=r($(this));$(".delete.modal .selected-orders").text(n.join(", ")),$(".delete.modal").modal("show")}function d(e){var n=$(".bulk-email-order.modal"),o=n.find(".email-list"),a=function(e){var n=$("<div/>",{"class":"form-group email-list-item"}),o=$("<div/>",{"class":"col-sm-2"}),a=$("<div/>",{"class":"col-sm-10"}),t=$("<label/>",{"class":"control-label id-label force-text-color-black force-text-normal-weight",text:e.id}),i=$("<input/>",{"class":"form-control email-input",type:"text",value:e.customerEmail});return t.appendTo(o),i.appendTo(a),n.append([o,a]),n.data("order",e),n},t=[];e.preventDefault(),x.find("tbody input:checkbox:checked").each(function(){var e=$(this).parents("tr").data();t.push(e)}),t.length&&(o.empty(),t.forEach(function(e){return o.append(a(e))}),n.modal("show"))}function c(e){var n=$(".bulk-email-invoice.modal"),o=n.find(".email-list"),a=function(e){var n=$("<div/>",{"class":"form-group email-list-item"}),o=$("<div/>",{"class":"col-sm-2"}),a=$("<div/>",{"class":"col-sm-10"}),t=$("<label/>",{"class":"control-label id-label force-text-color-black force-text-normal-weight",text:e.id}),i=$("<input/>",{"class":"form-control email-input",type:"text",value:e.customerEmail});return t.appendTo(o),i.appendTo(a),n.append([o,a]),n.data("invoice",e),n},t=[];e.preventDefault(),x.find("tbody input:checkbox:checked").each(function(){var e=$(this).parents("tr").data();t.push(e)}),t.length&&(o.empty(),t.forEach(function(e){return o.append(a(e))}),n.modal("show"))}function r(e){var n=[];if(e.parents(".bulk-action").length>0)x.find("tbody input:checkbox:checked").each(function(){n.push($(this).parents("tr").data("id"))});else{var o=e.parents("tr").data("id");if(!o)return;n.push(o)}return n}function l(){var e=$(".email-invoice.modal"),n=$(this).parents("tr").data(),o=jse.core.config.get("appUrl")+"/admin/admin.php",a={id:n.id,date:n.purchaseDate.date,"do":"OrdersModalsAjax/GetEmailInvoiceSubject",pageToken:jse.core.config.get("pageToken")};e.find(".customer-info").text('"'+n.customerName+'" "'+n.customerEmail+'"'),e.find(".email-address").val(n.customerEmail),e.data("orderId",n.id).modal("show"),$.ajax({url:o,data:a,dataType:"json"}).done(function(n){e.find(".subject").val(n.subject),n.invoiceIdExists?e.find(".invoice-num-info").addClass("hidden"):e.find(".invoice-num-info").removeClass("hidden")})}function s(e){var n=$(".email-order.modal"),o=$(this).parents("tr").data(),a="de"===jse.core.config.get("languageCode")?"DD.MM.YY":"MM.DD.YY";n.find(".customer-info").text('"'+o.customerName+'" "'+o.customerEmail+'"'),n.find(".subject").val(jse.core.lang.translate("ORDER_SUBJECT","gm_order_menu")+o.id+jse.core.lang.translate("ORDER_SUBJECT_FROM","gm_order_menu")+moment(o.purchaseDate).format(a)),n.find(".email-address").val(o.customerEmail),n.data("orderId",o.id).modal("show")}function u(e){$(e.target).hasClass("order-status")&&e.stopPropagation();var n=$(".status.modal"),o=$(this).parents("tr").data(),a=r($(this));n.find("#status-dropdown").val(o?o.statusId:""),n.find("#comment").val(""),n.find("#notify-customer, #send-parcel-tracking-code, #send-comment").attr("checked",!1).parents(".single-checkbox").removeClass("checked"),n.find(".selected-orders").text(a.join(", ")),n.modal("show")}function p(e){var n=$(".add-tracking-number.modal"),o=$(e.target).parents("tr").data();n.data("orderId",o.id),n.modal("show")}function h(){var e=[],n=$("#max-amount-invoices-bulk-pdf").text(),o=void 0,a=void 0;return x.find("tbody input:checkbox:checked").each(function(){e.push($(this).parents("tr").data("id"))}),e.length>n?(o=$(".bulk-error.modal"),o.modal("show"),a=o.find(".invoices-message"),a.removeClass("hidden"),void o.on("hide.bs.modal",function(){a.addClass("hidden")})):void f(e,"invoice")}function m(){var e=[],n=$("#max-amount-packing-slips-bulk-pdf").text(),o=void 0,a=void 0;return x.find("tbody input:checkbox:checked").each(function(){e.push($(this).parents("tr").data("id"))}),e.length>n?(o=$(".bulk-error.modal"),o.modal("show"),a=o.find(".packing-slips-message"),a.removeClass("hidden"),void o.on("hide.bs.modal",function(){a.addClass("hidden")})):void f(e,"packingslip")}function f(e,n){var o=[],a=$(".table-fixed-header thead.fixed").css("z-index");j=jse.libs.loading_spinner.show(x,a),e.forEach(function(e){var a={type:n,ajax:"1",oID:e};o.push($.getJSON(jse.core.config.get("appUrl")+"/admin/gm_pdf_order.php",a))}),$.when.apply(null,o).done(function(){k(e,n),x.DataTable().ajax.reload(function(){x.off("single_checkbox:ready",b).on("single_checkbox:ready",{orderIds:e},b)}),x.orders_overview_filter("reload")})}function b(e){e.data.orderIds.forEach(function(e){x.find("tr#"+e+" input:checkbox").single_checkbox("checked",!0).trigger("change")}),$("tr input:checkbox:checked").length&&$(".bulk-action").find("button").removeClass("disabled")}function k(e,n){var o={"do":"OrdersModalsAjax/BulkPdf"+("invoice"===n?"Invoices":"PackingSlips"),pageToken:jse.core.config.get("pageToken"),o:e},a=jse.core.config.get("appUrl")+"/admin/admin.php?"+$.param(o),t=window.open(a,"_blank");if(!t){var i=$(".bulk-download-error.modal"),d=i.find(".download-bulk-btn");d.attr("href",a),i.modal("show")}jse.libs.loading_spinner.hide(j)}function v(){var e=$(this).attr("href");window.open(e,"_blank"),x.DataTable().ajax.reload()}function g(){var e=$(this).parents("tr").data("id"),n={oID:e,action:"edit",overview:$.deparam(window.location.search.slice(1))};window.location.href="orders.php?"+$.param(n)}var x=$(this),w={},j=null;return w.init=function(e){x.on("click","tbody tr",o).on("change",".bulk-selection",n).on("change","input:checkbox",a).on("click",".invoice",v).on("click",".email-invoice",l).on("click",".email-order",s).on("click",".order-status.label",u).on("click",".add-tracking-number",p).on("click",".actions .edit",g),x.parents(".orders").on("click",".btn-group .change-status",u).on("click",".btn-group .cancel",t).on("click",".btn-group .delete, .actions .delete",i).on("click",".btn-group .bulk-email-order",d).on("click",".btn-group .bulk-email-invoice",c).on("click",".btn-group .bulk-download-invoice",h).on("click",".btn-group .bulk-download-packing-slip",m),e()},w});