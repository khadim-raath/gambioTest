function restore_backup(e,t){var o=/^\d+$/,r=0;e&&o.test(e)&&(r=e);var s=0;t&&o.test(t)&&(s=t);var a=$("select",t_lightbox_package).val();$.ajax({type:"GET",url:"request_port.php?module=DBBackup&action=restore_db_backup&filename="+a+"&file_position="+s+"&file_index="+r+"&page_token="+jse.core.config.get("pageToken"),timeout:3e4,dataType:"json",context:this,success:function(e){"object"!=$.type(e)||"continue_restore"!=e.status&&"restore_done"!=e.status?reset_backup("object"==$.type(e)?e.error_message:e):($(".progress_text",t_lightbox_package).html(e.progress+"%"),$(".progress_job",t_lightbox_package).html(e.job),$(".progress_marker",t_lightbox_package).width(e.progress+"%"),"continue_restore"==e.status?restore_backup(e.file_index,e.file_position):"restore_done"==e.status&&reset_backup())},error:function(e,t){reset_backup("Unbekannter Fehler!")}})}function reset_backup(e){var t=!1;""!=$.trim(e)&&"false"!=$.trim(e)&&(t=$.trim(e)),$.ajax({type:"GET",url:"request_port.php?module=DBBackup&action=reset_db_backup&page_token="+jse.core.config.get("pageToken"),timeout:3e4,context:this,success:function(e){0==t?($(".progress_job",t_lightbox_package).html(e.job),$("#db_backup_wrapper").html(e.html),$(".progress_marker",t_lightbox_package).width("100%"),$(".progress_text",t_lightbox_package).html("100%")):($(".db_backup_lightbox_error_message",t_lightbox_package).html(t).show(),$(".db_backup_lightbox_process",t_lightbox_package).hide()),$(".button_right_container .lightbox_close",t_lightbox_package).show()},error:function(e,o){reset_backup(t)}})}function reset(){$.ajax({type:"GET",url:"request_port.php?module=DBBackup&action=reset_db_backup&page_token="+jse.core.config.get("pageToken"),timeout:3e4,context:this,success:function(e){restore_backup(0)},error:function(e,t){reset()}})}$(".confirm_db_backup_restore",t_lightbox_package).bind("click",function(){return!$(this).hasClass("active")&&($(this).addClass("active").hide(),$(".button_left_container .lightbox_close",t_lightbox_package).hide(),$(".db_backup_lightbox_backup_select",t_lightbox_package).hide(),$(".db_backup_lightbox_process",t_lightbox_package).css("visibility","visible"),void reset())});