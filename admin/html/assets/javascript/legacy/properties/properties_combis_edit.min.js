function save_combis(i){var t=[];$(".lightbox_properties_combis_edit_content input[type=text]").each(function(){t.push(this.name+"="+encodeURIComponent(this.value))}),$(".lightbox_properties_combis_edit_content input[type=checkbox]:checked").each(function(){t.push(this.name+"="+this.value)}),$(".lightbox_properties_combis_edit_content select").each(function(){t.push(this.name+"="+this.value)}),t.push("products_id="+products_id),t.push("products_properties_combis_id="+products_properties_combis_id),$.ajax({url:"request_port.php?module=PropertiesCombisAdmin&action=save&type=combis",type:"POST",data:t.join("&"),dataType:"json",timeout:3e4,error:function(i,t){$.lightbox_plugin("error",t_lightbox_identifier,i,t)},success:function(t){$.isEmptyObject(t)?$(".lightbox_content_error").html(js_options.error_handling.lightbox_plugin.fatal_error):t.combis_exists&&"abort"==t.action?($(".lightbox_content_error").html(t.message).show(),$(".save").removeClass("active"),$(".save_close").removeClass("active")):(fb&&console.log(t.action+": success"),upload_image(t.combis_id,i))}})}function upload_image(i,t){$.ajaxFileUpload({url:"request_port.php?module=properties_combis_image_upload&combis_id="+i,secureuri:!1,fileElementId:"combi_image",dataType:"text",error:function(i,t){$.lightbox_plugin("error",t_lightbox_identifier,i,t)},success:function(e){$.ajax({url:"request_port.php?module=PropertiesCombisAdmin&action=load&template=combis_table&combis_id="+i+"&products_id="+products_id,timeout:2e3,dataType:"html",error:function(i,t){$.lightbox_plugin("error",t_lightbox_identifier,i,t)},success:function(t){var e=i,o=$("#box_properties_combis_row_"+e);o.remove();var r=!1;$.each($(".box_properties_combis_row"),function(){parseInt($(".properties_table_sortnr",this).html())>parseInt($("#properties_sort_order").val())&&0==r&&($(this).before('<tr id="box_properties_combis_row_'+e+'"></tr>'),r=!0)}),0==r&&$(".properties_view2 table").append('<tr id="box_properties_combis_row_'+e+'"></tr>'),$(".save").removeClass("active"),$("#box_properties_combis_row_"+e).replaceWith(t)}}),t&&$.lightbox_plugin("close",t_lightbox_identifier)}})}$(document).ready(function(){products_id=t_lightbox_parameters["_"+t_lightbox_identifier].products_id,products_properties_combis_id=t_lightbox_parameters["_"+t_lightbox_identifier].products_properties_combis_id,$("#combi_price_type").unbind("change"),$("#combi_price_type").bind("change",function(){"calc"==$(this).val()?$("#combi_price").attr("disabled","disabled"):$("#combi_price").removeAttr("disabled")}),0==products_properties_combis_id?($(".lightbox_content_button_container.navigation").css("visibility","hidden"),$(".lightbox_content_button_container .save").hide()):(""==$("#box_properties_combis_row_"+products_properties_combis_id).next().attr("id")&&$(".next").css("visibility","hidden"),""==$("#box_properties_combis_row_"+products_properties_combis_id).prev().attr("id")&&$(".previous").css("visibility","hidden"),$(".previous").unbind("click"),$(".previous").bind("click",function(){var i=$("#box_properties_combis_row_"+products_properties_combis_id).prev().attr("id").split("_")[4],t={products_id:products_id,products_properties_combis_id:i,lightbox_identifier:t_lightbox_identifier};return $.ajax({type:"GET",dataType:"json",url:"request_port.php?module=LightboxPluginAdmin",data:{action:"get_template",template:"properties_combis_edit.html",section:"admin",param:t},success:function(i){$(".lightbox_content_container").html(i.html)},error:function(){alert("Connection Error - Unable to connect to server")}}),!1}),$(".next").unbind("click"),$(".next").bind("click",function(){var i=$("#box_properties_combis_row_"+products_properties_combis_id).next().attr("id").split("_")[4],t={products_id:products_id,products_properties_combis_id:i,lightbox_identifier:t_lightbox_identifier};return $.ajax({type:"GET",dataType:"json",url:"request_port.php?module=LightboxPluginAdmin",data:{action:"get_template",template:"properties_combis_edit.html",section:"admin",param:t},success:function(i){$(".lightbox_content_container").html(i.html)},error:function(){alert("Connection Error - Unable to connect to server")}}),!1})),$(".save").unbind("click"),$(".save").bind("click",function(){return 1!=$(this).hasClass("active")&&($(this).addClass("active"),save_combis(!1),!1)}),$(".save_close").unbind("click"),$(".save_close").bind("click",function(){return 1!=$(this).hasClass("active")&&($(this).addClass("active"),save_combis(!0),!1)})});