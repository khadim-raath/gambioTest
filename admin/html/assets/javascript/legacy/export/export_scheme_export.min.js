function run_import(e){var t="undefined"==typeof e?0:e;return t_request=$.ajax({type:"POST",url:"../request_port.php?module=CSV&action=import",dataType:"json",context:this,data:$("#import_form_container form").serialize()+"&progress="+t,success:function(e){if(null==e)return $(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),void $(".close",t_lightbox_package).show();var t=e.progress;$(".export_progress_text",t_lightbox_package).html(t+"%"),$(".export_progress_marker",t_lightbox_package).width(t+"%"),$(".export_job",t_lightbox_package).html(e.job),1==e.repeat?0==t_progress_canceled?run_import(t):($(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show()):0==e.repeat&&(1==e.error?($(".export_message",t_lightbox_package).html(e.message).css("color","red"),$(".export_progress_bar",t_lightbox_package).css("visibility","hidden"),$(".export_progress_text",t_lightbox_package).css("visibility","hidden")):$(".export_message",t_lightbox_package).html(e.message),t_request=!1,0!=e.rebuild_index?run_rebuild_properties_index(t):($(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show()))},error:function(e,t){$(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show(),$.lightbox_plugin("error",t_lightbox_identifier,e,t)}}),!1}function run_rebuild_properties_index(e){return t_request=$.ajax({type:"POST",url:"../request_port.php?module=CSV&action=rebuild_properties_index",dataType:"json",context:this,success:function(e){if(null==e)return $(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),void $(".close",t_lightbox_package).show();var t=e.progress;$(".export_progress_text",t_lightbox_package).html(t+"%"),$(".export_progress_marker",t_lightbox_package).width(t+"%"),$(".export_job",t_lightbox_package).html(e.job),1==e.repeat?0==t_progress_canceled?run_rebuild_properties_index(t):($(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show()):0==e.repeat&&(1==e.error?($(".export_message",t_lightbox_package).html(e.message).css("color","red"),$(".export_progress_bar",t_lightbox_package).css("visibility","hidden"),$(".export_progress_text",t_lightbox_package).css("visibility","hidden")):$(".export_message",t_lightbox_package).html(e.message),t_request=!1,$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show())},error:function(e,t){$(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show(),$.lightbox_plugin("error",t_lightbox_identifier,e,t)}}),!1}function run_export(){var e=Math.round(1e6*Math.random());return t_request=$.ajax({type:"GET",url:"../request_port.php?module=CSV&action=export",dataType:"json",context:this,data:{scheme_id:t_scheme_id,token:t_token,rand:e},success:function(e){if(null==e)return $(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show(),void $(document).trigger("resume_actualize_cronjob_status");var t=e.progress;$(".export_progress_text",t_lightbox_package).html(t+"%"),$(".export_progress_marker",t_lightbox_package).width(t+"%"),$(".export_job",t_lightbox_package).html(e.job),1==e.repeat?0==t_progress_canceled?run_export():$.ajax({type:"POST",url:"request_port.php?module=CSV&action=clean_export",timeout:1e4,dataType:"json",context:this,data:{scheme_id:t_scheme_id},success:function(){$.lightbox_plugin("close",t_lightbox_identifier)}}):0==e.repeat&&(t_request=!1,$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show(),$("#tab_container_"+e.export_type).html(e.html),$.initialize_tooltip_plugin(),$(document).trigger("resume_actualize_cronjob_status"),"true"==t_lightbox_data.download&&($(".close").text(jse.core.lang.translate("download_and_close","csv")),$(".close",t_lightbox_package).on("click",function(){window.open("../request_port.php?module=CSV&action=download_export_file&scheme_id="+t_scheme_id,"_blank")})))},error:function(e,t){$(".export_message").html(js_options.error_handling.csv.response_error),$(".export_progress_text").html("-%"),$(".export_progress_marker").width("0%"),$(".export_job").html(js_options.error_handling.error+"!"),$(".cancel",t_lightbox_package).hide(),$(".close",t_lightbox_package).show(),$(document).trigger("resume_actualize_cronjob_status"),$.lightbox_plugin("error",t_lightbox_identifier,e,t)}}),!1}var t_scheme_id=t_lightbox_data.scheme_id,t_token=t_lightbox_data.token,t_timeout=!1,t_request=!1,t_progress_canceled=!1,t_progress=0;$(t_lightbox_package).delegate(".cancel","click",function(){t_progress_canceled=!0,$(this).addClass("active"),$(".export_message",t_lightbox_package).css("visibility","visible").html(js_options.error_handling.csv.export_canceled)}),$(t_lightbox_package).delegate(".close","click",function(){0!=t_timeout&&clearTimeout(t_timeout),$.lightbox_plugin("close",t_lightbox_identifier)}),"undefined"==typeof t_lightbox_data.filename?run_export():run_import();